---
title: "Managing Associations: Patterns and Examples"
description: "Dive deep into association APIs generated by GORM CLI. Learn proven workflows for creating, linking, updating, unlinking, and deleting related records. Includes real-world use cases for one-to-many and many-to-many relationships."
---

# Managing Associations: Patterns and Examples

Dive deep into the association APIs generated by GORM CLI. This guide walks you through practical workflows to create, link, update, unlink, and delete related records, illustrating real-world use cases for one-to-many and many-to-many relationships. Whether you need to manage single associations like "has one" or bulk operations on collections in "has many" or "many to many", you will find step-by-step patterns and best practices here.

---

## Overview

GORM CLI generates powerful and type-safe association helpers on your models enabling advanced relationship management with compile-time safety and minimal boilerplate. These helpers appear as `field.Struct[T]` for single associations and `field.Slice[T]` for collections on your generated model variables.

Supported association operations can be combined inside `.Set(...).Create(ctx)` or `.Set(...).Update(ctx)` commands:

- **Create:** Insert new related records per matched parent.
- **CreateInBatch:** Batch create multiple related records for each matched parent.
- **Update:** Modify related records satisfying optional conditions.
- **Unlink:** Remove association links without deleting related records.
- **Delete:** Delete related records or join entries in many-to-many cases.

### Association Types and Semantics

| Association Type | Unlink Effect                    | Delete Effect                        |
|------------------|---------------------------------|------------------------------------|
| Belongs To       | Sets parent's FK to NULL         | Deletes associated record           |
| Has One / Has Many | Sets child's FK to NULL        | Deletes child records               |
| Many to Many     | Removes join table rows only     | Removes join rows; related entities remain |

Parent operations semantics:

- `Create(ctx)`: Creates parent row, then runs association create actions.
- `Update(ctx)`: Updates matched parents, then runs association updates/unlink/delete.

---

## Step-by-Step Examples and Patterns

### 1. Creating Associated Records

Create new related records at the time of parent creation or update.

```go
// Create a new User with one Pet
gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Pets.Create(
      generated.Pet.Name.Set("fido"),
    ),
  ).
  Create(ctx)

// Create a new User and link many Languages (many2many)
gorm.G[User](db).
  Set(
    generated.User.Name.Set("polyglot"),
    generated.User.Languages.CreateInBatch([]models.Language{{Code: "EN"}, {Code: "FR"}}),
  ).
  Create(ctx)

// Create one Pet for each matched existing User
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Create(generated.Pet.Name.Set("fido"))).
  Update(ctx)
```

**Expected Results**:
- New parent record created or matched.
- Associated child records inserted and linked via foreign keys or join tables.

---

### 2. Updating Associated Records with Conditions

Update related records filtered by association conditions.

```go
// Update pets named 'old' to 'new' for matched users
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Update(
      generated.Pet.Name.Set("new"),
    ),
  ).
  Update(ctx)
```

**Outcomes**:
- Child pets named "old" associated with the given user have their `Name` updated to "new".

---

### 3. Unlinking Associations (Removing Links, Not Data)

Unlink removes association without deleting related rows. Use to clear foreign keys or remove join table entries.

```go
// Unlink all pets from a user (retain pets, set user_id=NULL)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)

// Unlink with condition
orm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Unlink()).
  Update(ctx)

// Unlink in many2many: remove join rows but keep associated entities
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.Where(generated.Language.Code.Eq("EN")).Unlink()).
  Update(ctx)
```

**Tip**: After unlink, related entities remain in the database but association keys are cleared.

---

### 4. Deleting Associated Records

Delete removes the associated rows or join rows in many-to-many relationships.

```go
// Delete pets named 'a' associated with user
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("a")).Delete()).
  Update(ctx)

// Delete join rows only in many2many
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Friends.Where(generated.User.Name.Eq("friend-a")).Delete()).
  Update(ctx)
```

**Notes**:
- Many2many Delete removes join entries only; associated entities remain.
- For belongs to and has one/many, Delete removes rows themselves.

---

### 5. Batch Creating Associations

Batch creates multiple related records efficiently linked to each matched parent.

```go
// Batch create many Pets for a user
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.CreateInBatch([]models.Pet{{Name: "bm1"}, {Name: "bm2"}})).
  Update(ctx)

// Batch create many Languages (many2many)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch([]models.Language{{Code: "B1"}, {Code: "B2"}})).
  Update(ctx)
```

This leverages the generated association helpers to efficiently insert and link multiple records.

---

## Real-World Use Cases

### Managing a User's Pets (Has Many)

- Add new pets
- Rename or modify existing pets with filters
- Unlink pets temporarily without deleting
- Permanently remove pets
- Batch add multiple pets at once

### Handling Many2Many Relationships (Languages, Friends)

- Link new languages or friends when creating or updating User
- Update attributes on the associated entities
- Unlink associations (remove join rows only)
- Delete join rows without deleting the foreign entities

### Belongs To Associations (Company)

- Update the company details linked to a user
- Unlink the user from a company by nulling the foreign key

### Polymorphic Associations (e.g., Pet’s Toy)

- Create and update polymorphic associated objects
- Unlink by zeroing foreign keys but retaining rows
- Delete related polymorphic rows

---

## Best Practices and Tips

- Always use `Set(...).Create(ctx)` for new parents and associations, and `Set(...).Update(ctx)` when modifying existing parent rows.
- Use `.Where(...)` on association helpers to filter associated records precisely before update, unlink, or delete.
- For large inserts with many associations, prefer `CreateInBatch` to optimize SQL operations.
- Remember unlinking associations preserves related rows but detaches them; deleting associations removes rows (or join records in many2many).
- In polymorphic associations, unlink sets foreign key fields to zero values but does not delete rows.
- Check foreign key constraints and ensure nullable FK columns are used where unlinking sets null.

---

## Troubleshooting Common Issues

### Associations Not Updating or Linking
- Verify you use the correct generated association helper matching your model field.
- Confirm that the WHERE conditions on the association are correctly scoped; empty conditions update all associated records.
- Ensure parent records are matched by your `Where` clause before calling `Update(ctx)`.

### Foreign Keys Not Being Cleared on Unlink
- Check that the foreign key column is nullable in your DB schema.
- Verify your association type matches the behavior you expect (belongs to vs has many).

### Data Not Deleting as Expected
- For many2many, `Delete()` only removes join rows, not related entities.
- For single associations, confirm that foreign key cascading or manual delete is configured.

### Batch Create Operations Failing
- Inspect that the record slice passed to `CreateInBatch` contains valid data; zero values for required fields cause errors.
- Ensure your DB supports batch insert if you have custom dialect considerations.

---

## Related Content & Next Steps

- [Using Generated APIs in Your Application](/guides/getting-started/using-generated-apis) – Learn how to incorporate generated APIs in your Go projects.
- [Defining Models & Query Interfaces](/getting-started/first-generation/define-models-interfaces) – Author Go structs and interfaces that drive code generation.
- [Run the Code Generator](/getting-started/first-generation/run-code-generator) – Execute GORM CLI to generate APIs including associations.
- [Field Helper Best Practices](/guides/generation-patterns/field-helper-best-practices) – Advanced tips on leveraging generated predicate and setter helpers.
- [Template-based Query Generation](/guides/generation-patterns/template-sql-gen) – Customize query interface methods with SQL templates.

Harness these association patterns to maximize the power and safety of your GORM-powered applications with the GORM CLI.
