---
title: "Working with Associations: Linked Data Made Easy"
description: "A practical tutorial on association helpers—creating, linking, updating, deleting, and unlinking related models. Covers pattern usage for has one, has many, belongs to, and many2many relationships, with best practice examples."
---

# Working with Associations: Linked Data Made Easy

This guide provides a practical tutorial on how to use association helpers generated by GORM CLI to manage linked data efficiently. It covers creating, linking, updating, deleting, and unlinking associated models with best practice examples across different association types such as has one, has many, belongs to, and many2many.

---

## Workflow Overview

**Objective:** Enable you to manage complex data relationships in your database easily by leveraging strong, type-safe association helpers generated by GORM CLI.

**Prerequisites:**
- Familiarity with your existing Go data models.
- Generated query APIs and field helpers from GORM CLI (see [Generating Code](https://docs.example.com/getting-started/first-use-configuration/generating-code)).
- A working GORM database connection (`*gorm.DB`).

**Expected Outcome:**
- You will confidently perform CRUD operations on related records.
- Use association helpers to create, update, unlink (detach associations), and delete related data while maintaining referential integrity.

**Estimated Time:** 20–30 minutes to learn and practice the core patterns.

**Difficulty Level:** Intermediate (basic understanding of GORM recommended).

---

## 1. Understanding Association Helpers

GORM CLI generates typed association helpers for your models. These helpers provide a fluent API to work with linked data using the following:

- **Struct[T]**: For single associations like `has one` and `belongs to`.
- **Slice[T]**: For multiple associations like `has many` and `many2many`.

These helpers are accessible on the generated model variables, e.g. `generated.User.Account` (has one), `generated.User.Pets` (has many), or `generated.User.Languages` (many2many).

### Semantics by Association Type:

| Association Type | Unlink Behavior                     | Delete Behavior                     |
|------------------|-----------------------------------|-----------------------------------|
| `belongs to`     | Sets parent's foreign key to NULL | Deletes the associated row         |
| `has one`        | Sets child's foreign key to NULL  | Deletes the associated row         |
| `has many`       | Sets children's foreign keys NULL | Deletes child rows                 |
| `many2many`      | Removes join table rows only       | Removes join rows only             |

---

## 2. Creating and Linking Associations

Create and link related models during `Create` or `Update` on a parent model **atomically**.

### Example: Create a user with one pet (has many)

```go
gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Pets.Create(generated.Pet.Name.Set("fido")),
  ).
  Create(ctx)
```

This will insert a new user and create an associated pet with the correct foreign key.

### Example: Create and link many languages (many2many) to a user

```go
gorm.G[User](db).
  Set(
    generated.User.Name.Set("polyglot"),
    generated.User.Languages.CreateInBatch([]models.Language{{Code: "EN"}, {Code: "FR"}}),
  ).
  Create(ctx)
```

This inserts the user and links existing or new Language rows via the join table.

---

## 3. Updating Associated Records

You can target associated records for update using conditions with `.Where(...)`. This is useful for precise modifications without affecting unrelated associations.

### Example: Update a user's pet named "fido"

```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).
      Update(generated.Pet.Name.Set("rex")),
  ).
  Update(ctx)
```

This updates the pet name to "rex" only for related pets matching the condition.

---

## 4. Unlinking Associations

Unlinking removes the association but **does not delete** the associated records:

- For `belongs to` and `has one/has many`, unlink sets the foreign key to `NULL`.
- For `many2many`, unlink removes entries in the join table.

### Example: Unlink all pets from a user

```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)
```

This keeps the pet rows but detaches the association by nullifying the foreign key `user_id`.

---

## 5. Deleting Associated Records

Deleting removes associated rows entirely:

- For `has many` and `has one`, deletes child rows.
- For `many2many`, deletes only join table rows; associated models themselves remain.

### Example: Delete pets named "old" for a user

```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Delete()).
  Update(ctx)
```

This deletes pet records named "old" linked to the user.

---

## 6. Batch Operations

You can batch create and link many associated records for `has many` and `many2many` in one call, improving efficiency.

### Example: Batch link existing pets to a user

```go
pets := []models.Pet{{Name: "bm1"}, {Name: "bm2"}}
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.CreateInBatch(pets)).
  Update(ctx)
```

### Example: Batch link many languages to a user

```go
langs := []models.Language{{Code: "B1"}, {Code: "B2"}}
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch(langs)).
  Update(ctx)
```

---

## 7. Polymorphic Associations

Polymorphic associations (e.g., a Pet's Toy) are supported with the same API.

### Example: Update, unlink, and delete a polymorphic association

```go
// Update toy name
gorm.G[models.Pet](db).
  Where(generated.Pet.ID.Eq(petID)).
  Set(generated.Pet.Toy.Where(generated.Toy.Name.Eq("ball")).Update(generated.Toy.Name.Set("cube"))).
  Update(ctx)

// Unlink toy (sets polymorphic keys to zero or NULL)
gorm.G[models.Pet](db).
  Where(generated.Pet.ID.Eq(petID)).
  Set(generated.Pet.Toy.Unlink()).
  Update(ctx)

// Delete toy row
gorm.G[models.Pet](db).
  Where(generated.Pet.ID.Eq(petID)).
  Set(generated.Pet.Toy.Delete()).
  Update(ctx)
```

---

## 8. Common Patterns and Best Practices

- **Always specify a filtering condition on the parent (`Where`) before association operations** to prevent unintended updates or deletes.
- Use **`CreateInBatch`** for bulk association creations for better performance.
- Prefer **Unlink** over Delete when you want to keep associated records but just detach the link.
- Combine multiple association operations using `Set(...)` to express complex changes in one atomic statement.
- For many2many, remember that **Delete only removes join rows; associated entities remain** unless explicitly deleted separately.

---

## 9. Troubleshooting

<AccordionGroup title="Troubleshooting Association Operations">
<Accordion title="Association Not Updated or Linked">
- **Cause:** Missing or incorrect `Where` condition on the parent query.
- **Fix:** Always verify your parent filter is correct and effectively narrows the parents to target.
</Accordion>
<Accordion title="Foreign Key Not Set as Expected">
- **Cause:** Incorrect model relationship or missing foreign key tags in your Go models.
- **Fix:** Ensure your GORM model struct tags like `foreignKey` and `references` are correct and consistent.
</Accordion>
<Accordion title="Unlink Deletes Rows Unexpectedly">
- **Cause:** Confusing `Unlink` with `Delete` semantics.
- **Fix:** Use `Unlink()` for just removing references (e.g., nullify FK), and `Delete()` only if you intend to remove rows.
</Accordion>
<Accordion title="Batch Create Fails or Partially Associates">
- **Cause:** Underlying database constraints or complex join table schema.
- **Fix:** Check database join table schema matches your GORM many2many setup exactly.

</Accordion>
</AccordionGroup>

<Tip>
When writing code, always chain your conditions and association methods fluently and test on a small dataset to avoid accidental mass updates or deletes.
</Tip>

---

## 10. Example Summaries

Here are concise runnable examples drawn from real test cases to guide your practical use.

```go
// Create a pet named "fido" for User ID 1
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Create(generated.Pet.Name.Set("fido"))).
  Update(ctx)

// Update pet name from "fido" to "rex" for User ID 1
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Update(generated.Pet.Name.Set("rex"))).
  Update(ctx)

// Unlink all Pets from User ID 1
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)

// Delete Pets named "old" for User ID 1
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Delete()).
  Update(ctx)

// Batch create and link Pets to User ID 1
pets := []models.Pet{{Name: "bm1"}, {Name: "bm2"}}
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.CreateInBatch(pets)).
  Update(ctx)

// Create and link Languages in a many2many with User ID 1
langs := []models.Language{{Code: "EN"}, {Code: "FR"}}
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch(langs)).
  Update(ctx)
```

---

## Next Steps & Related Content

- Explore [Using the Generated Query APIs and Field Helpers](https://docs.example.com/guides/core-workflows/using-generated-apis) to deepen understanding of generated code patterns.
- Review [Template-Based SQL with Interfaces](https://docs.example.com/guides/advanced-usage/writing-sql-templates) to write flexible queries.
- Integrate seamlessly with [GORM and Go Tooling](https://docs.example.com/overview/real-world-integration-use-cases/integration-with-gorm-and-tooling).
- Continue with [Debugging, Troubleshooting, and Performance Tips](https://docs.example.com/guides/real-world-examples/debugging-and-optimizing) to optimize your use.

---

## For Developer Reference

See the source for association helpers definition in `field/association.go` providing the underlying methods such as `Create()`, `Update()`, `Unlink()`, `Delete()`, and `CreateInBatch()`:

<Source url="https://github.com/go-gorm/cli" paths={[{"path": "field/association.go", "range": "1-70"}]} />