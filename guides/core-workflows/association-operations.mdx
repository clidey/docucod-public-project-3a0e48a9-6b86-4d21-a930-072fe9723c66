---
title: "Guided: Managing Associations Safely"
description: "Practical guides for using GORM CLI's association helpers to create, update, unlink, and delete related records (across has one, has many, belongs to, and many2many). Covers end-to-end flows and semantic differences to ensure safe, predictable relationship handling."
---

# Guided: Managing Associations Safely

Efficiently managing relationships between your data models is crucial for building robust applications. This guide walks you through using GORM CLI's association helpers to **create**, **update**, **unlink**, and **delete** related records safely and predictably. Whether your models have _has one_, _has many_, _belongs to_, or _many-to-many_ relationships, this guide provides end-to-end workflows and explains semantic differences to avoid common pitfalls.

---

## Workflow Overview

### Task Description
This guide shows you how to leverage association helpers generated by GORM CLI to perform safe and expressive operations on related records. It covers operations across various relationship types and clarifies the semantic impact of actions like unlinking versus deleting.

### Prerequisites
- You have GORM CLI installed and set up
- Your Go project uses GORM v2 with Go 1.18+ (generics support)
- Models and query interfaces are defined and generated using GORM CLI
- Familiarity with basic GORM CLI query and field helper usage

### Expected Outcome
By following this guide, you will be able to:
- Create related records correlated correctly to parent models
- Update associations with or without filtering conditions
- Remove associations cleanly without unintended data loss
- Delete associated records when appropriate
- Use batch creation for efficiency

### Time Estimate
10–20 minutes to solidify understanding, longer for hands-on practice in your codebase

### Difficulty Level
Intermediate (requires GORM CLI familiarity and some understanding of model relations)

---

## Step-by-Step Instructions

### 1. Understand Association Helper Types

GORM CLI generates two primary types of association helpers:
- `field.Struct[T]`: for single-value associations (`has one`, `belongs to`)
- `field.Slice[T]`: for multiple-value associations (`has many`, `many2many`)

Each helper provides chainable methods for operations filtered as needed.

### 2. Creating Associated Records

**Use Case:** Add new related records when creating or updating parents.

- For single associations (`has one`, `belongs to`), use `Create(assignments...)`.
- For multi associations (`has many`, `many2many`), use either `Create(assignments...)` for one record or `CreateInBatch([]T)` to add multiple records.

**Example:** Create a new user with an associated pet.

```go
gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Pets.Create(generated.Pet.Name.Set("fido")),
  ).
  Create(ctx)
```

**Expected result:** A `User` record and a linked `Pet` record are inserted together.

### 3. Updating Associated Records

**Use Case:** Modify related records conditionally.

- Use `Where(...)` on the association field to add filters.
- Chain with `Update(assignments...)` to specify field changes.

**Example:** Update a user’s pet name where the current name is "fido".

```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).
      Update(generated.Pet.Name.Set("rex")),
  ).
  Update(ctx)
```

**Expected result:** Only pets named "fido" belonging to the user with ID 1 will have their name changed to "rex".

### 4. Unlinking Associations Without Deleting Records

**Use Case:** Remove the relationship between parent and child records, but keep the associated data intact.

Unlink behaves differently based on association type:
- `belongs to`: sets the parent’s foreign key to NULL
- `has one` / `has many`: sets the child's foreign key to NULL
- `many2many`: removes join table rows only

**Example:** Unlink all pets from a user (child foreign keys set to NULL).

```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)
```

**Expected result:** Pets remain in the database but are no longer linked to the user.

### 5. Deleting Associated Records

**Use Case:** Permanently remove associated records when they are no longer needed.

- Use `Where(...)` on association to filter target records.
- Call `Delete()` on the association.

**Example:** Delete pets with name "old" for a user.

```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Delete()).
  Update(ctx)
```

**Expected result:** Pets named "old" linked to user ID 1 are removed from the database.

### 6. Batch Creating and Linking Existing Records

When you have multiple existing associated records to link (especially for `has many` and `many2many`), use `CreateInBatch(records []T)`. This method links all provided records to each matched parent.

**Example:** Batch link multiple languages to a single user.

```go
langs := []models.Language{{Code: "EN"}, {Code: "FR"}}
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch(langs)).
  Update(ctx)
```

**Expected result:** The user is associated with the specified languages in a single operation.

### 7. Combining Parent and Association Operations

Parent operations (`Create(ctx)` or `Update(ctx)`) perform the parent row changes and then apply all specified association operations in the `Set(...)` call.

- `Create(ctx)`: inserts new parent rows with values and associations
- `Update(ctx)`: updates matched parent rows and applies association changes

---

## Examples & Common Scenarios

### Creating a User With One Pet
```go
_, err := gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Pets.Create(generated.Pet.Name.Set("fido")),
  ).
  Create(ctx)
```

### Updating a User's Associated Account Number
```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Account.Where(generated.Account.Number.Eq("A-001")).
      Update(generated.Account.Number.Set("A-002")),
  ).
  Update(ctx)
```

### Unlinking a Belongs To Association (Company)
```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Company.Unlink()).
  Update(ctx)
```

### Deleting a Pet of a User by Condition
```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Delete()).
  Update(ctx)
```

### Batch Linking Many Languages to a User
```go
langs := []models.Language{{Code: "EN"}, {Code: "FR"}}
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch(langs)).
  Update(ctx)
```

---

## Troubleshooting & Tips

### Common Issues
- **No effect on associations:** Confirm `Set(...)` is called and chained with `.Create(ctx)` or `.Update(ctx)`.
- **Foreign key not set on create:** Association create only works if parent rows are matched correctly (`Where` before `Set`).
- **Unlink sets wrong nulls:** Semantics differ with association type; verify correct association helper and use unlink only if you want to preserve data.
- **Batch create not working:** Ensure your DB and GORM versions support batch operations; use `CreateInBatch()` correctly.

### Best Practices
- Always filter parent records carefully before applying association operations to avoid unintended global changes.
- Use `Where(...)` on association helpers to target specific child records.
- Prefer `Unlink()` when you want to keep associated rows but sever the relationship.
- Use `Delete()` cautiously; it permanently removes data.
- Combine multiple association operations in a single `Set(...)` call for atomicity.

### Performance Considerations
- Batch creating associations reduces the number of DB round-trips.
- Filtering conditions on associations reduce scope and speed up update/delete operations.

---

## Semantic Differences by Association Type

| Operation | Belongs To                     | Has One / Has Many                            | Many to Many                             |
| ----------|-------------------------------|----------------------------------------------|----------------------------------------|
| Unlink    | Sets parent's FK to NULL       | Sets child's FK to NULL                       | Deletes join table rows only            |
| Delete    | Deletes associated row(s)      | Deletes child row(s)                          | Deletes join table rows only; keeps rows |
| Create    | Creates and sets FK on parent  | Creates and sets FK on child                  | Creates join table rows linking records |

---

## Next Steps & Related Content

- Explore [Working with Model-Driven Field Helpers](https://docs.example.com/guides/core-workflows/using-field-helpers) to master predicates and setters.
- See [Quickstart: Generate Type-Safe APIs](https://docs.example.com/guides/core-workflows/quickstart-generate) to generate your code.
- Review [Best Practices and Performance Tips](https://docs.example.com/guides/advanced-patterns/best-practices-performance) for optimal use.
- Deepen your understanding with [Association Handling & Operations](https://docs.example.com/concepts/data-models-fields/associations-model) for more conceptual knowledge.

---

Use these practical workflows as a foundation for managing associations in your GORM CLI-powered Go applications, ensuring safe, efficient, and maintainable data relationships.
