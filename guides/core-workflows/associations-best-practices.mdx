---
title: "Working with Associations: Create, Update, Unlink, Delete"
description: "Detailed guidance on managing associations (has one, has many, belongs to, many2many) using generated helper methods. Covers safe linking, batch operations, conditional updates, and deletion with real examples."
---

# Working with Associations: Create, Update, Unlink, Delete

Mastering associations is key to efficient use of GORM CLI's power. This guide delivers detailed, practical instructions for managing associations in your models—whether `has one`, `has many`, `belongs to`, or `many2many`—using the generated field helpers. Our approach ensures you work with compile-time safety, clear semantics, and idiomatic GORM integration all at once.

---

## 1. Understanding Association Types and Helpers

GORM CLI generates strongly typed association helpers based on your model relationships:

- `Struct[T]`: For single-object associations (`has one`, `belongs to`).
- `Slice[T]`: For multi-object associations (`has many`, `many2many`).

These helpers enable operations like Create, Update, Unlink, Delete, and batch creations with clear syntax.

### Semantics Overview
- **belongs to**: The parent holds a foreign key to the associated row.
- **has one / has many**: The associated child holds the foreign key.
- **many2many**: Managed through a join table.

Each association type behaves differently for unlinking and deleting:

| Operation | belongs to      | has one / has many | many2many         |
|-----------|----------------|-------------------|-------------------|
| `Unlink` | Sets parent's FK to NULL | Sets child's FK to NULL | Removes join rows only |
| `Delete`  | Deletes associated rows  | Deletes child rows       | Removes join rows only |

---

## 2. Workflow Overview

### Task Description
Manage related data records safely through the generated association helpers. Perform create, update, unlink, delete, and batch operations on associations while preserving relationship integrity.

### Prerequisites
- Generated code exists for your models including association helpers (e.g. `generated.User.Pets`).
- A working GORM DB instance (`*gorm.DB`) connected to your database.
- A proper Go context (`context.Context`) for DB calls.

### Expected Outcome
You will be able to manipulate associations seamlessly with type-safe and readable APIs that correspond precisely to your model relationships.

### Time Estimate
This guide can be absorbed and applied within 30 minutes for standard operations; complex batch and conditional workflows may take longer.

### Difficulty Level
Intermediate (requires working knowledge of GORM and Go generics).

---

## 3. Step-by-Step Instructions

<Steps>
<Step title="Create Associated Records">
Use the `Create` and `CreateInBatch` helpers to add and link new associated records for matched parent records.

```go
// Create one associated pet for a user
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(userID)).
  Set(generated.User.Pets.Create(generated.Pet.Name.Set("fido"))).
  Update(ctx)
```

For batch creation (for `has many` or `many2many` associations):

```go
// Batch create many pets for a user
pets := []models.Pet{{Name: "fido"}, {Name: "rex"}}
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(userID)).
  Set(generated.User.Pets.CreateInBatch(pets)).
  Update(ctx)
```

<Check>Verify new associated records have been created and linked properly via foreign keys.</Check>
</Step>

<Step title="Update Associated Records Conditionally">
Update associated records with optional filtering conditions, applying changes only to matched rows.

```go
// Update all pets named 'fido' owned by a user to name 'rex'
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(userID)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Update(
      generated.Pet.Name.Set("rex"),
    ),
  ).
  Update(ctx)
```

<Check>Confirm that only the filtered pets have updated values.</Check>
</Step>

<Step title="Unlink Associations">
Safely disassociate related rows without deleting them. Unlink will nullify foreign keys or remove join entries depending on association type.

```go
// Unlink all pets from a user (pets remain, but are not associated)
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(userID)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)
```

<Check>Verify foreign keys are set to NULL or join table entries removed, but associated rows still exist.</Check>
</Step>

<Step title="Delete Associated Records">
Remove associated rows completely. Deletes associated records or join table entries as appropriate.

```go
// Delete pets named 'rex' associated with a user
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(userID)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("rex")).Delete()).
  Update(ctx)
```

<Check>Confirm associated records are removed from the database.</Check>
</Step>
</Steps>

---

## 4. Practical Examples

### Creating a User With Associated Pets and Languages

```go
_, err := gorm.G[User](db).
  Set(
    generated.User.Name.Set("polyglot"),
    generated.User.Pets.Create(
      generated.Pet.Name.Set("fido"),
    ),
    generated.User.Languages.CreateInBatch([]models.Language{{Code: "EN"}, {Code: "FR"}}),
  ).
  Create(ctx)
```

### Updating an Associated Pet’s Name Conditionally

```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Update(
      generated.Pet.Name.Set("rex"),
    ),
  ).
  Update(ctx)
```

### Unlinking All Pets from a User (Retain Pet Records)

```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)
```

### Deleting Associated Rows Matching a Condition

```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Delete()).
  Update(ctx)
```

### Batch Linking Many Languages to Existing User

```go
lngs := []models.Language{{Code: "EN"}, {Code: "FR"}}
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch(lngs)).
  Update(ctx)
```

---

## 5. Best Practices & Tips

- **Always scope operations carefully:** Use `Where` clauses on associations to avoid accidental broad updates or deletes.
- **Prefer `Unlink` to disassociate without data loss:** Useful when you want to break a link but keep associated rows.
- **Batch operations optimize performance:** Use `CreateInBatch` for multiple associations to reduce DB roundtrips.
- **Test association behavior in dev environments:** Especially for polymorphic and many2many relations.
- **Refer to generated helpers for correct naming:** They reflect model fields and association names precisely.

---

## 6. Troubleshooting Common Issues

<AccordionGroup title="Association Operation Troubleshooting">
<Accordion title="Associated Rows Not Created or Linked">
- Ensure parent rows match your `Where` conditions.
- Confirm that `Set(...).Create(ctx)` or `Set(...).Update(ctx)` is used properly.
- Verify foreign keys and association names in your model are correct.
</Accordion>
<Accordion title="Unlink Leaves Foreign Keys Intact">
- Check you are calling `Unlink()` on the correct association helper.
- Ensure your DB schema supports nullable foreign keys.
</Accordion>
<Accordion title="Delete Removes More Rows Than Expected">
- Always use `Where` filters on associations to avoid deleting unintended data.
- Review join conditions in many2many associations.
</Accordion>
<Accordion title="Batch Create Fails or Panics">
- Validate input slice is non-empty.
- Verify model structs match the generated helpers.
</Accordion>
</AccordionGroup>

---

## 7. Next Steps & Related Content

- Explore [Using Generated Field Helpers for Filtering and Updates](https://docs.gorm.io/guides/core-workflows/using-generated-field-helpers.html) to combine associations with precise queries.
- Deep dive into [Defining Query Interfaces and SQL Templates](https://docs.gorm.io/guides/core-workflows/query-apis-and-templates.html) to enrich your data access layer.
- Customize generation with [Configuring Generation with genconfig.Config](https://docs.gorm.io/guides/advanced-usage/configuring-generation.html) for tailored helper output.
- Learn advanced techniques in [Custom Field Helpers (JSON Fields Example)](https://docs.gorm.io/guides/advanced-usage/custom-field-helpers.html).

---

## 8. Illustrative Workflow Diagram

```mermaid
flowchart TD
  UserModel["User Model"] -->|Defines associations| GeneratedHelpers["Generated Association Helpers"]
  GeneratedHelpers -->|Create / CreateInBatch| DBOperations["DB Create Operations"]
  GeneratedHelpers -->|Update (with Conditions)| DBOperations
  GeneratedHelpers -->|Unlink| DBOperations
  GeneratedHelpers -->|Delete| DBOperations

  subgraph "User Actions"
    UA1["Create Associated Records"]
    UA2["Update Associated Records"]
    UA3["Unlink Associations"]
    UA4["Delete Associated Records"]
  end

  UA1 --> GeneratedHelpers
  UA2 --> GeneratedHelpers
  UA3 --> GeneratedHelpers
  UA4 --> GeneratedHelpers

  DBOperations -->|Apply Changes| Database["Underlying Database"]
```

---

> This guide empowers you to control your model's associations with confidence and precision using GORM CLI generated helpers, ensuring your data integrity and developer productivity scale gracefully with your project complexity.
