---
title: "Working with Associations: Patterns & Best Practices"
description: "Deep dive into generating and using association helpers for parent-child and many-to-many relationships. Includes detailed CRUD patterns, handling batch operations, filtering, unlinking, and deleting associations with robust, type-safe helpers."
---

# Working with Associations: Patterns & Best Practices

Deep dive into generating and using association helpers for parent-child and many-to-many relationships. This guide covers detailed Create, Read, Update, Delete (CRUD) patterns, handling batch operations, filtering with conditions, unlinking, and deleting associations using robust, type-safe helpers generated by GORM CLI.

---

## 1. Understanding Association Helpers

GORM CLI generates association helpers on your models as strongly typed fields for each association declared in your structs. These helpers enable you to perform type-safe operations such as creating, updating, unlinking, deleting, and batch-creating related records.

### Association Helper Types
- **Struct[T]**: Represents a single association (e.g., `has one`, `belongs to`).
- **Slice[T]**: Represents multiple associations (e.g., `has many`, `many to many`).

Example usage on a generated User model:
```go
generated.User.Account   // Struct[Account] (has one)
generated.User.Pets      // Slice[Pet] (has many)
generated.User.Languages // Slice[Language] (many2many)
```

### Supported Association Operations
- **Create**: Create & associate new related rows
- **Update**: Update existing associated records satisfying optional conditions
- **Unlink**: Remove the association without deleting rows (clears FKs or removes join rows)
- **Delete**: Delete associated records or join rows (depending on association type)
- **CreateInBatch**: Batch create multiple associated records per parent

<Tip>
Use these operations combined with `Set(...).Create(ctx)` or `Set(...).Update(ctx)` methods on the parent query to apply changes atomically and type-safely.
</Tip>

---

## 2. Common Usage Patterns

### 2.1 Creating Associations

Create operations insert new related records and link them to each matched parent record.

```go
// Create a new user and one pet (has many)
gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Pets.Create(generated.Pet.Name.Set("fido")),
  ).
  Create(ctx)

// Create and link languages (many2many) when creating the user
gorm.G[User](db).
  Set(
    generated.User.Name.Set("polyglot"),
    generated.User.Languages.CreateInBatch([]models.Language{{Code: "EN"}, {Code: "FR"}}),
  ).
  Create(ctx)

// Create one pet for each matched user
orm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Create(generated.Pet.Name.Set("fido"))).
  Update(ctx)
```

### 2.2 Updating Associations

Updates apply to the associated rows filtered optionally by `.Where` conditions.

```go
// Update a user's pet where name = 'fido'
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Update(
    generated.Pet.Name.Set("rex"),
  )).
  Update(ctx)
```

### 2.3 Unlinking Associations

Unlink removes associations without deleting rows:
- For `belongs to`: sets parent's FK to NULL
- For `has one` / `has many`: sets child's FK to NULL
- For `many to many`: removes join table rows

```go
// Unlink all a user's pets (clear foreign keys)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)

// Unlink conditionally
orm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Unlink()).
  Update(ctx)
```

### 2.4 Deleting Associations

Delete operations remove associated rows (or join rows in many2many) matching optional conditions.

```go
// Delete all associated pets for a user
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Delete()).
  Update(ctx)

// Delete pets where name='old'
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Delete()).
  Update(ctx)
```

---

## 3. Association Operation Details

### Semantics of `Unlink` by Association Type:
- **Belongs To**: Sets the foreign key on the parent record to NULL, keeping the associated record intact.
- **Has One / Has Many**: Sets the foreign key on the associated child records to NULL, detaching them.
- **Many to Many**: Removes the join table rows that link parent and associated records, without deleting either side.

### Semantics of `Delete` by Association Type:
- **Belongs To**: Deletes the associated record(s) referenced.
- **Has One / Has Many**: Deletes the child record(s).
- **Many to Many**: Removes join rows only, leaving associated records intact.

<Tip>
Use `Unlink` when you want to disassociate without data loss.
Use `Delete` when you want to remove associated database records.
</Tip>

### Filtering Associated Records with `.Where`

You can apply conditions to association operations to target specific rows:

```go
// Update associated pets named 'fido'
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Update(
    generated.Pet.Name.Set("rex"))).
  Update(ctx)

// Delete associated pets with age < 5
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Age.Lt(5)).Delete()).
  Update(ctx)
```

---

## 4. Batch Create for Associations

Batch create lets you create and link multiple records at once to each matched parent. It is supported for `has many` and `many to many` associations.

```go
// Batch create pets for user (has many)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.CreateInBatch([]models.Pet{{Name: "bm1"}, {Name: "bm2"}})).
  Update(ctx)

// Batch create associated languages (many2many)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch([]models.Language{{Code: "B1"}, {Code: "B2"}})).
  Update(ctx)
```

<Tip>
Batch operations improve performance by reducing database interactions and leveraging bulk inserts when supported.
</Tip>

---

## 5. Real-World Association Scenarios

### Has One Association

Example: User has one Account

```go
// Create Account when creating User
gorm.G[User](db).
  Set(
    generated.User.Name.Set("bob"),
    generated.User.Account.Create(generated.Account.Number.Set("A-001")),
  ).Create(ctx)

// Update Account where Number = "A-001"
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Account.Where(generated.Account.Number.Eq("A-001")).Update(
      generated.Account.Number.Set("A-002"),
    ),
  ).Update(ctx)

// Unlink Account (set UserID to NULL)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Account.Unlink()).
  Update(ctx)

// Delete Account
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Account.Delete()).
  Update(ctx)
```

### Belongs To Association

Example: User belongs to Company

```go
// Update company where Name="Acme"
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Company.Where(generated.Company.Name.Eq("Acme")).Update(
      generated.Company.Name.Set("NewCo"),
    ),
  ).Update(ctx)

// Unlink company from user (set CompanyID NULL)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Company.Unlink()).
  Update(ctx)

// Note company remains in database
```

### Many to Many Association

Example: User speaks many Languages

```go
// Create and link new Language
orm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.Create(
    generated.Language.Code.Set("EN"),
    generated.Language.Name.Set("English"),
  )).
  Update(ctx)

// Update associated Language
orm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.Where(generated.Language.Code.Eq("EN")).Update(
    generated.Language.Name.Set("English-US"),
  )).
  Update(ctx)

// Unlink the Language (removes join rows only)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.Where(generated.Language.Code.Eq("EN")).Unlink()).
  Update(ctx)

// Delete association join rows but keep language record
```

### Polymorphic Associations

Example: Pet has one Toy (polymorphic)

```go
// Update associated Toy
orm.G[Pet](db).
  Where(generated.Pet.ID.Eq(1)).
  Set(generated.Pet.Toy.Where(generated.Toy.Name.Eq("ball")).Update(
    generated.Toy.Name.Set("cube"),
  )).
  Update(ctx)

// Unlink Toy (clear OwnerID and OwnerType)
gorm.G[Pet](db).
  Where(generated.Pet.ID.Eq(1)).
  Set(generated.Pet.Toy.Unlink()).
  Update(ctx)

// Delete Toy record
orm.G[Pet](db).
  Where(generated.Pet.ID.Eq(1)).
  Set(generated.Pet.Toy.Delete()).
  Update(ctx)
```

---

## 6. Troubleshooting & Best Practices

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Association Create Fails">
Verify the related model's fields satisfy required constraints and the parent query matches records. Create on associations requires valid foreign key setup.
</Accordion>
<Accordion title="Update Does Not Affect Associated Rows">
Ensure conditions inside `.Where()` target the associated records accurately. Remember, update applies only to filtered association rows.
</Accordion>
<Accordion title="Unlink Does Not Set FK to NULL">
Confirm the association is defined correctly in models with proper foreign keys. Unlink relies on foreign key nullification.
</Accordion>
<Accordion title="Batch Create Performance Issue">
Use batch create (`CreateInBatch`) for multiple records to avoid per-row database calls.
</Accordion>
</AccordionGroup>

### Best Practices
- Use generated helpers for clarity, avoiding manual SQL string building.
- Always check return errors from `Update(ctx)` and `Create(ctx)` calls.
- Chain `.Where()` conditions to precisely modify associated records.
- Prefer `Unlink` to safely disassociate without deleting data.
- Batch create when adding multiple associations simultaneously.

---

## 7. Next Steps & Further Reading

- Explore [Using Model-Driven Field Helpers](/guides/core-workflows/field-helper-generation) to leverage field predicates and update assignments.
- Review [Defining Models and Query Interfaces](/getting-started/first-code-generation/defining-models-and-interfaces) to optimize your model annotations for associations.
- Consult [Running the Code Generator](/getting-started/first-code-generation/running-gorm-cli-gen) to ensure your generated code is up to date.
- See full association examples in the `examples/output/models_relations_test.go` included with the GORM CLI repo.

---

For a visual overview of association integration, see the system architecture section in related docs.

---

*End of Guide*