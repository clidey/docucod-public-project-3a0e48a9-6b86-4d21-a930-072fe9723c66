---
title: "Working with Associations"
description: "Explore association helpers and advanced relationship operations (Create, Update, Unlink, Delete, and batching). Discover best practices for managing has-one, has-many, belongs-to, and many2many relationships in generated code."
---

# Working with Associations

Explore association helpers and advanced relationship operations (Create, Update, Unlink, Delete, and batching). Discover best practices for managing has-one, has-many, belongs-to, and many2many relationships in generated code.

---

## 1. Understanding Association Helpers

GORM CLI generates **association helpers** for relationships defined in your Go models. These helpers provide a type-safe, fluent API to manage complex relational data with operations such as creating, updating, unlinking, and deleting associated records.

### Association Types Supported
- **Has One**: A single associated record (e.g., `User.Account`).
- **Has Many**: Multiple associated records (e.g., `User.Pets`).
- **Belongs To**: The model belongs to a parent (e.g., `User.Company`).
- **Many To Many**: Multiple related records through a join table (e.g., `User.Languages`).

### What Association Helpers Enable
- Creating and associating new related records
- Updating related records with optional filtering
- Unlinking associations without deleting related data
- Deleting related records (with different semantics depending on association type)
- Batch operations for `has many` and `many2many` associations

---

## 2. How to Use Association Operations

Operations on associations appear as methods attached to generated field helpers, typically named as the association field (e.g., `generated.User.Pets`). They are used within the `.Set()` method of GORM CLI's fluent API and finalized with `.Create(ctx)` or `.Update(ctx)` calls on the parent entity.

### Common API Methods
- `.Create(...)` — Create and associate a new record (single or multiple, depending on association type).
- `.CreateInBatch([]T)` — Batch create multiple associated records.
- `.Update(...)` — Update associated records matching optional conditions.
- `.Unlink()` — Remove the association but keep associated rows.
- `.Delete()` — Remove/delete associated rows (semantics depend on association type).

<Tip>
Think of these as atomic instructions that you pass to a parent model's `Set` method to manipulate related records declaratively and safely within a single database operation.
</Tip>

---

## 3. Step-by-Step Workflows by Association Type

### 3.1 Has One / Belongs To Associations

#### Create and Link
```go
gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Account.Create(generated.Account.Number.Set("A-001")),
  ).
  Create(ctx)
```
*Creates a user and a linked account in one call.*

#### Update Associated Record
```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Account.Where(generated.Account.Number.Eq("A-001")).Update(
      generated.Account.Number.Set("A-002"),
    ),
  ).
  Update(ctx)
```
*Updates an account's number only if it matches condition.*

#### Unlink Association
```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Account.Unlink()).
  Update(ctx)
```
*Sets the foreign key in `Account` to NULL, preserving the account record.*

#### Delete Associated Row
```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Account.Delete()).
  Update(ctx)
```
*Deletes the associated account record.*

---

### 3.2 Has Many Associations

#### Create One Associated Record Per Parent
```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Create(generated.Pet.Name.Set("fido"))).
  Update(ctx)
```
*Creates a pet and associates it to matched user(s).* 

#### Batch Create Multiple Records per Parent
```go
pets := []Pet{{Name: "bm1"}, {Name: "bm2"}}
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.CreateInBatch(pets)).
  Update(ctx)
```
*Associates multiple pets to the user in batch.*

#### Update Associated Records with Conditions
```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Update(generated.Pet.Name.Set("new")),
  ).
  Update(ctx)
```
*Updates pet names conditionally.*

#### Unlink Pets
```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)
```
*Sets pets' foreign key pointing to the user to NULL but keeps pet records.*

#### Delete Associated Pets
```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Delete()).
  Update(ctx)
```
*Deletes all pets associated with matched users.*

---

### 3.3 Belongs To Associations

#### Update Parent Record Through Child
```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Company.Where(generated.Company.Name.Eq("Acme")).Update(generated.Company.Name.Set("NewCo"))).
  Update(ctx)
```
*Updates company record linked to user.*

#### Unlink Parent
```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Company.Unlink()).
  Update(ctx)
```
*Sets the foreign key in user to NULL but keeps the company record.*

---

### 3.4 Many To Many Associations

#### Create and Link Associated Records
```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.Create(generated.Language.Code.Set("EN"), generated.Language.Name.Set("English"))).
  Update(ctx)
```
*Creates or links a language to the user.*

#### Batch Link Many Records
```go
langs := []Language{{Code: "EN"}, {Code: "FR"}}
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch(langs)).
  Update(ctx)
```
*Associates multiple languages in batch.*

#### Update Through Many To Many Join
```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.Where(generated.Language.Code.Eq("EN")).Update(generated.Language.Name.Set("English-US"))).
  Update(ctx)
```
*Updates related languages where conditions match.*

#### Unlink Associations (Delete Join Table Rows)
```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.Where(generated.Language.Code.Eq("EN")).Unlink()).
  Update(ctx)
```
*Removes join table rows, but keeps related records.*

#### Delete Join Rows (Many2Many Delete Semantics)
```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.Where(generated.Language.Code.Eq("EN2")).Delete()).
  Update(ctx)
```
*Deletes join rows only; records remain intact.*

---

## 4. Polymorphic Associations

Polymorphic associations like `Pet.Toy` work with the same API methods, managing polymorphic foreign keys transparently.

Example:

```go
gorm.G[Pet](db).
  Where(generated.Pet.ID.Eq(petID)).
  Set(generated.Pet.Toy.Create(generated.Toy.Name.Set("ball"))).
  Update(ctx)

// Update
gorm.G[Pet](db).
  Where(generated.Pet.ID.Eq(petID)).
  Set(generated.Pet.Toy.Where(generated.Toy.Name.Eq("ball")).Update(generated.Toy.Name.Set("cube"))).
  Update(ctx)

// Unlink
gorm.G[Pet](db).
  Where(generated.Pet.ID.Eq(petID)).
  Set(generated.Pet.Toy.Unlink()).
  Update(ctx)

// Delete
gorm.G[Pet](db).
  Where(generated.Pet.ID.Eq(petID)).
  Set(generated.Pet.Toy.Delete()).
  Update(ctx)
```

This workflow updates the `owner_id` and `owner_type` polymorphic keys accordingly.

---

## 5. Best Practices and Tips

- **Start simple:** Use `.Create()` for quick association inserts. If linking multiple records, prefer `.CreateInBatch()` for performance.
- **Use `.Where()` filters** on associations to update or delete selectively.
- **Unlink does not delete rows:** Use unlink when you want to disassociate but preserve data.
- **Understand semantic differences:** Unlink and Delete behave differently depending on the association type.
- **Polymorphic fields** work the same; treat them with generated association helpers.
- **Parent entity operations:** Use `.Create(ctx)` to insert new parents and their associations. Use `.Update(ctx)` to modify existing parents and associations.

<Tip>
Plan your association operations according to your domain logic: prefer unlink over delete when historical data must be preserved.
</Tip>

---

## 6. Troubleshooting Common Association Issues

<AccordionGroup title="Troubleshooting Association Operations">
<Accordion title="No Effect When Updating Associations">
Check that you are calling `.Update(ctx)` or `.Create(ctx)` on the correct parent entity builder after calling `.Set()` with your association operations.

Also, ensure `.Where()` on the parent selects the intended records.
</Accordion>
<Accordion title="Foreign Key Not Set on Created Associated Record">
Verify your model correctly defines foreign keys for the association.
Generated code relies on GORM conventions; missing or inconsistent struct tags can cause incorrect FK handling.
</Accordion>
<Accordion title="Batch Create Not Linking Records">
Confirm you pass a slice of struct values to `.CreateInBatch()`.
The batch operation creates associations for each matched parent.

If you seed existing records, ensure primary keys are set correctly.
</Accordion>
<Accordion title="Unlink Leaves Foreign Keys Intact">
Unlink sets foreign keys to NULL for `has one` and `has many` but may require database schema allowance (e.g., foreign key constraints allowing NULL).

Review DB schema and GORM model for nullable foreign keys.
</Accordion>
<Accordion title="Delete Removes Join Rows but Not Related Records in Many2Many">
This is expected behavior. `Delete` for many2many removes only join rows.
If you want to remove records entirely, do so explicitly outside the association API.
</Accordion>
</AccordionGroup>

---

## 7. Next Steps & Related Content

- Master working with **[Type-Safe Query APIs](guides/getting-started-workflows/using-type-safe-queries.md)** to extend your data manipulation capabilities.
- Explore **[Field Helpers for Filters and Updates](guides/getting-started-workflows/field-helper-basics.md)** to compose complex queries and updates.
- Deep dive into **[Template-Based SQL Queries](guides/advanced-usage-patterns/template-sql-queries.md)** for advanced custom queries.
- Customize generation via **[Basic Generation Config](getting-started/optional-configuration/basic-configuration.md)** and **[Custom Field Mappings](getting-started/optional-configuration/custom-field-mappings.md)** to tailor helpers to your domain.

For foundational setup, start at the **[Quick Setup & First Generation](guides/getting-started-workflows/quick-setup.md)** guide if you haven’t generated code yet.

---