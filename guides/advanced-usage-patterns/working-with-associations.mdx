---
title: "Working with Associations Safely"
description: "Guides users through handling associations using the generated helpers: creating, linking, updating, unlinking, or deleting related records. Includes practical use cases for belongs-to, has-many, and many-to-many relationships."
---

# Working with Associations Safely

This guide empowers you to effectively manage your database associations using the GORM CLI generated field helpers. Associations such as `belongs to`, `has one`, `has many`, and `many to many` are seamlessly handled with type-safe, fluent methods that ensure compile-time safety and reduce runtime errors.

---

## Overview

### What You Will Learn
- How to create, associate, update, unlink, and delete related records safely using generated helpers.
- Best practices tailored to different association types: belongs to, has one, has many, many to many, and polymorphic associations.
- Use cases illustrating common workflows for manipulating associations.

### Prerequisites
- You have a Go project with GORM CLI generated code, specifically the generated field helpers for your models.
- Familiarity with basic GORM operations and Go generics.
- Your models and their associations are defined and generated in your project.

### Expected Outcome
After following this guide, you will confidently perform safe association operations with minimal boilerplate code, leveraging the generated helpers for clear, maintainable, and error-resistant database manipulations.

---

## Understanding Generated Association Helpers

The GORM CLI generates helpers to manage associations, accessible as fields on your model's helper variable (e.g., `generated.User`). These helpers are of two main types:

- `field.Struct[T]`: Represents a single associated record (used in `belongs to` and `has one` associations).
- `field.Slice[T]`: Represents multiple associated records (used in `has many` and `many to many` associations).

These helper types provide fluent methods to build association operations:

| Operation          | Description                                              | Helper Method Example                              |
|--------------------|----------------------------------------------------------|--------------------------------------------------|
| Create             | Create and associate new related records                 | `.Create(assignments...)`                          |
| CreateInBatch      | Batch create for multiple related records                 | `.CreateInBatch(records []T)`                      |
| Update             | Update associated records matching optional conditions   | `.Where(conditions...).Update(assignments...)`    |
| Unlink             | Remove association link, without deleting related records | `.Where(conditions...).Unlink()` or `.Unlink()`   |
| Delete             | Delete associated records (join rows for many2many only) | `.Where(conditions...).Delete()`                   |

Each of these is used in conjunction with GORM's `Set()` and `Update(ctx)` or `Create(ctx)` methods for parent records.

---

## Step-by-Step Guide to Association Operations

### 1. Creating and Linking Associations

Use association helper `Create` or `CreateInBatch` for new child or related records.

```go
// Create a new user and one pet (has many)
gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Pets.Create(generated.Pet.Name.Set("fido")),
  ).
  Create(ctx)

// Create a new user and link multiple languages (many to many)
gorm.G[User](db).
  Set(
    generated.User.Name.Set("polyglot"),
    generated.User.Languages.CreateInBatch([]models.Language{{Code: "EN"}, {Code: "FR"}}),
  ).
  Create(ctx)
```

**Outcome:** Parent and associated records are inserted in the database, with links established.

### 2. Updating Associated Records with Conditions

Update specific related records by applying predicate filters using `.Where(...)` combined with `.Update(...)`.

```go
// Update a user's pet name where pet name equals "fido"
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Update(generated.Pet.Name.Set("rex")),
  ).
  Update(ctx)
```

**Outcome:** Only pets named "fido" linked to the user with ID 1 are renamed to "rex".

### 3. Unlinking Associations Without Deletion

Remove the association link but keep related records intact:

- For `belongs to`: sets parent's foreign key to `NULL`.
- For `has one` / `has many`: sets child's foreign key to `NULL`.
- For `many to many`: deletes join rows only.

```go
// Unlink all pets from user (has many) without deleting pet records
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)

// Unlink company (belongs to) from user
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Company.Unlink()).
  Update(ctx)
```

**Outcome:** Foreign keys are cleared or join rows removed, but data rows remain.

### 4. Deleting Associated Records

Delete related records or many-to-many join rows using `.Delete()`.

```go
// Delete pets named "old" associated with user
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Delete()).
  Update(ctx)

// Delete many2many join rows (associated languages) for user
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.Where(generated.Language.Code.Eq("EN")).Delete()).
  Update(ctx)
```

**Outcome:** Targeted associated rows or join entries are removed respecting constraints by association type.

### 5. Batch Creating or Linking Multiple Associated Records

For `has many` or `many to many` supporting batch inserts, use `.CreateInBatch(...)` with a slice of models.

```go
// Batch create pets linked to user
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.CreateInBatch([]models.Pet{{Name: "bm1"}, {Name: "bm2"}})).
  Update(ctx)

// Batch link languages to a user (assumes languages exist or created)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch([]models.Language{{Code: "B1"}, {Code: "B2"}})).
  Update(ctx)
```

**Outcome:** Multiple associations created efficiently in a single operation.

---

## Association Semantics by Type

| Association Type | Unlink Behavior                               | Delete Behavior                              |
|------------------|-----------------------------------------------|----------------------------------------------|
| Belongs To       | Sets parent's FK to `NULL`                     | Deletes associated rows                      |
| Has One / Many   | Sets child's FK to `NULL`                      | Deletes child rows                           |
| Many2Many        | Removes join table rows only                    | Removes join table rows only; rows remain   |

Knowing these distinctions ensures you choose appropriate operations to maintain data integrity.

---

## Practical Examples

### Creating a User with One Pet:

```go
_, err := gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Pets.Create(generated.Pet.Name.Set("fido")),
  ).
  Create(ctx)
if err != nil {
  // handle error
}
```

### Updating a Related Pet’s Name with a Condition:

```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Update(generated.Pet.Name.Set("rex")),
  ).
  Update(ctx)
```

### Unlink Pets Without Deleting:

```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)
```

### Batch Linking Languages:

```go
languages := []models.Language{{Code: "EN"}, {Code: "FR"}}
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch(languages)).
  Update(ctx)
```

---

## Troubleshooting & Tips

### Common Issues

- **Association name typo:** Always use the exact generated association helper name matching your model field (case-sensitive).
- **Using `Unlink()` on many2many deletes join rows only:** To delete rows, use `.Delete()`, not `Unlink()`.
- **Attempting batch operations on unsupported association types:** CreateInBatch works only for slice types (`has many`, `many2many`).

### Best Practices

- Always check whether your association is single (`Struct`) or multiple (`Slice`) before choosing methods.
- Use `.Where(...)` on association helpers to precisely target related records.
- Use transactions when performing multiple association operations affecting data integrity.
- Prefer `Create` or `CreateInBatch` inside `Set(...)` to keep association insertions atomic with parent insert.

### Performance Considerations

- Batch creates (`CreateInBatch`) are more performant than iterative creates.
- When unlinking large numbers of associations, consider indexing your foreign keys to aid performance.

---

## Next Steps

- Explore [Mastering the SQL Template DSL](../template-dsl-and-sql-templates) to write advanced queries for filters and updates.
- Learn to use [Using the Generated APIs in Your Project](../using-generated-apis) for integrating these helpers into application logic.
- Check out [Best Practices for Code Generation Configuration](../generation-config-best-practices) for tailoring helper generation to your needs.

---

## Additional References

- Official GitHub Repository: [GORM CLI on GitHub](https://github.com/go-gorm/cli)
- Related GORM Concepts: [Core Concepts & Terminology](../../overview/system-architecture/core-concepts-terminology)
- Model Examples: [Example User Model](../../examples/models/user.go)

---

With these tools and techniques, managing your GORM associations becomes straightforward, reliable, and efficient — empowering your application with strong data relationships handled safely at compile time.