---
title: "Working with Associations"
description: "Learn how to use association helpers generated for relations like has-one, has-many, belongs-to, and many-to-many. This guide illustrates association queries, CRUD operations, and real-world composition patterns that preserve type safety and fluency."
---

# Working with Associations

Learn how to use association helpers generated for relations like has-one, has-many, belongs-to, and many-to-many. This guide illustrates association queries, CRUD operations, and real-world composition patterns that preserve type safety and fluency.

---

## 1. Introduction to Association Helpers

GORM CLI generates *association helpers* on your models that simplify working with related data via associations. These helpers provide type-safe, fluent methods for common relational operations tailored to each association type:

- **Has-One / Belongs-To**: Single related model
- **Has-Many / Many-to-Many**: Multiple related models

Each association helper is available as either:

- `field.Struct[T]` for single-related fields
- `field.Slice[T]` for multiple-related fields

These helpers let you compose operations like Create, Update, Delete, Unlink, and batch creations in an intuitive, consistent way using the familiar GORM `Set(...).Update(ctx)` or `Set(...).Create(ctx)` patterns.


<Tip>
Using association helpers ensures compile-time type safety and keeps your queries expressive and concise when manipulating relations.
</Tip>

## 2. Prerequisites

Before using association helpers, ensure:

- You have generated the model-driven field helpers using GORM CLI based on your Go structs and associations.
- You understand your model relationships in terms of GORM associations (has-one, has-many, many2many, belongs-to).
- You have a GORM `*gorm.DB` instance connected to your database.
- You are familiar with basic GORM CRUD patterns and the `Set(...)` composition style.

## 3. Expected Outcomes

After following this guide, you will be able to:

- Use created association helpers to perform association-based CRUD operations.
- Compose complex association updates with conditions.
- Unlink or delete associated records safely and properly.
- Batch create/link multiple associated records effortlessly.
- Understand the semantics of each operation by association type.


## 4. Core Association Operations and Usage Patterns

### 4.1 Creating Associations

You can create and associate related records in one fluent operation. Two main methods are:

- `Create(assignments ...)`: Creates one related record per matched parent with specified field assignments.
- `CreateInBatch([]T)`: Batch creates multiple related records per matched parent at once (only for slice associations).

**Example: Create one pet for a matched user**
```go
gorm.G[models.User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Create(
      generated.Pet.Name.Set("fido"),
    ),
  ).
  Update(ctx)
```

**Example: Batch create multiple languages for a user (many2many)**
```go
langs := []models.Language{{Code: "EN"}, {Code: "FR"}}
gorm.G[models.User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch(langs)).
  Update(ctx)
```

### 4.2 Updating Associated Records

Update one or more associated records, optionally filtering them with conditions using the `Where(...)` helper on the association:

- Use `association.Where(condition).Update(assignments...)` to prepare the update.
- Compose inside `Set(...)` and call `Update(ctx)` on the parent.

**Example: Update pets named 'old' to 'new' for a specific user**
```go
gorm.G[models.User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Update(
      generated.Pet.Name.Set("new"),
    ),
  ).
  Update(ctx)
```

### 4.3 Deleting Associated Records

Delete associated records completely. Note the semantics differ by association type:

- `Delete()` on has-one / has-many deletes child rows.
- On many2many, deletes remove join table rows only; related rows remain.

Use with optional conditions via `Where(...)` to target specific records.

**Example: Delete pet named 'a' for a user**
```go
gorm.G[models.User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("a")).Delete()).
  Update(ctx)
```

### 4.4 Unlinking Associations

Unlinking removes the association without deleting the associated records:

- **belongs to:** sets parent's foreign key to NULL
- **has one / has many:** sets child's foreign key to NULL
- **many2many:** removes join table rows only

Can be applied with optional conditions.

**Example: Unlink all pets from a user (pets remain, just disassociated)**
```go
gorm.G[models.User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)
```

### 4.5 Composing Operations

Combine association helpers inside `Set(...)` to manage multiple associations in one parent update or create:

```go
gorm.G[models.User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Account.Create(generated.Account.Number.Set("A-001")),
    generated.User.Pets.CreateInBatch([]models.Pet{{Name: "dog"}, {Name: "cat"}}),
  ).
  Create(ctx)
```

## 5. Understanding Association Semantics

| Association Type | Create | Update | Delete | Unlink |
|------------------|---------|--------|--------|--------|
| belongs to       | Create and link parent record | Update parent record | Delete parent record | Sets FK to NULL on parent |
| has one         | Create child record | Update child record | Delete child record | Sets FK to NULL on child |
| has many        | Create multiple child records | Update multiple child records | Delete child records | Sets FK to NULL on children |
| many2many       | Create and link via join table | Update related records | Delete join table rows only | Remove join table rows only |


## 6. Step-by-Step Instructions

<Steps>
<Step title="Step 1: Identify Your Associations">
Review your Go model structs and generated field helpers. Look for `field.Struct[T]` or `field.Slice[T]` fields representing associations.
</Step>

<Step title="Step 2: Prepare Parent Query">
Start a GORM query on the parent model to filter target rows for association operations using `.Where(...)`.
</Step>

<Step title="Step 3: Build Association Operation">
Use generated helpers like `.Create(...)`, `.CreateInBatch(...)`, `.Update(...)`, `.Delete()`, `.Unlink()` on the association helpers. Add `.Where(...)` on associations if you want to filter associated records.
</Step>

<Step title="Step 4: Compose Set(...) with Association Operations">
Call `.Set(...)` on the parent query with the generated association operations as arguments.
</Step>

<Step title="Step 5: Execute Parent Update or Create">
Call `.Update(ctx)` or `.Create(ctx)` on the parent query to apply the association changes.
</Step>

<Step title="Step 6: Verify Changes">
Query your database after operation to confirm expected records were created, updated, deleted, or unlinked according to your intent.
</Step>
</Steps>

## 7. Real-World Examples

### 7.1 Creating a Single Has-Many Association
```go
// Create one pet named 'fido' for user with ID 1
gorm.G[models.User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Create(generated.Pet.Name.Set("fido")),
  ).
  Update(ctx)
```

### 7.2 Batch Creating Many2Many Associations
```go
// Batch link multiple languages to user 1
langs := []models.Language{{Code: "EN"}, {Code: "FR"}}
gorm.G[models.User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch(langs)).
  Update(ctx)
```

### 7.3 Updating an Associated Has-One with Condition
```go
// Update user's account number to 'A-002' where current number is 'A-001'
gorm.G[models.User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Account.Where(generated.Account.Number.Eq("A-001")).Update(
      generated.Account.Number.Set("A-002"),
    ),
  ).
  Update(ctx)
```

### 7.4 Unlinking Many2Many Associations with Condition
```go
// Unlink language EN from user 1
gorm.G[models.User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.Where(generated.Language.Code.Eq("EN")).Unlink()).
  Update(ctx)
```

### 7.5 Deleting Associated Rows With Condition
```go
// Delete user's pet named 'old'
gorm.G[models.User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Delete()).
  Update(ctx)
```

## 8. Troubleshooting & Tips

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Association Create Does Not Link Correctly">
- Verify that you use `Set(...).Create(ctx)` or `Set(...).Update(ctx)` correctly.
- Make sure you filtered the parent records properly with `.Where(...)`.
- Confirm your association names match the generated helper names.
</Accordion>

<Accordion title="Unlink Leaves Foreign Keys Non-NULL">
- Check the association type semantics. Unlink sets FKs to NULL only if model FK columns allow NULL.
- Ensure your database schema supports NULLable FK.
</Accordion>

<Accordion title="Batch Create On Single Associations Fails">
- `CreateInBatch` is only supported on slice associations (`field.Slice[T]`). Use `Create` for single associations.
</Accordion>

<Accordion title="Updates With Conditions Not Applying">
- Confirm you add correct `.Where(...)` conditions on the association helper.
- Ensure the conditions cover the fields and values targeting the right associated rows.
</Accordion>
</AccordionGroup>

<Tip>
Always test your association operations in a local environment first to validate expected behavior and side effects before running on production data.
</Tip>

## 9. Next Steps & Further Reading

- Explore [Template-Based Queries & SQL DSL](../template-based-queries) to combine powerful SQL templating with association operations.
- Learn about [Custom Field Helpers & Generator Configuration](../custom-field-helpers-configuration) to extend and customize association helpers.
- Review [Generating and Using Type-Safe APIs](../generating-using-apis) to deepen your understanding of GORM CLI generated code.
- Consult the [Core Concepts & Terminology](../../overview/product-intro-basics/core-concepts-terminology) for foundational knowledge on how these helpers fit.

---

## Appendix: Association Operation Methods Reference

| Method         | Description                                                               | Applicable To               |
|----------------|---------------------------------------------------------------------------|-----------------------------|
| `Create(assignments ...clause.Assignment)` | Prepare a create + link operation for one associated record | `field.Struct[T]` & `field.Slice[T]` |
| `CreateInBatch(records []T)` | Batch create multiple records connected to the parent(s) | `field.Slice[T]` only |
| `Update(assignments ...clause.Assignment)` | Update matching associated records with conditions (optional) | On `associationWithConditions`        |
| `Delete()`     | Delete associated records or join table entries (many2many) | `associationWithConditions` (set via `Where`)                |
| `Unlink()`     | Remove association links but keep associated records | `associationWithConditions` (set via `Where`)                |


## Reference: Common Pattern for Using Associations

```go
// Filter parents
parentQuery := gorm.G[models.User](db).Where(generated.User.ID.Eq(1))

// Compose associations with optional conditions
assocOp := generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Update(
  generated.Pet.Name.Set("new"),
)

// Set association ops on parent
parentQuery.Set(assocOp).Update(ctx)
```


---

For detailed examples, refer to the [models_relations_test.go](https://github.com/go-gorm/cli/blob/main/examples/output/models_relations_test.go) file in the GORM CLI repository.
