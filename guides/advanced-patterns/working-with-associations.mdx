---
title: "Working with Associations"
description: "Deep dive into association helpers for relationships like has-one, has-many, belongs-to, and many-to-many. Covers linking, updating, and deleting related records, with best-practice workflows and sample queries."
---

# Working with Associations

## Overview

This guide provides an in-depth look at working with association helpers generated by GORM CLI. Associations such as `has-one`, `has-many`, `belongs-to`, and `many-to-many` are crucial for expressing relationships between models in your database schema. GORM CLI generates type-safe, model-driven association helpers that allow you to create, update, unlink, delete, and batch-create related records easily and efficiently.

You will learn how to perform common association operations in a practical, step-by-step manner with well-illustrated examples and best practices drawn from real-world use cases.

---

## Prerequisites

- You have already defined your Go models with appropriate GORM tags representing associations.
- You have generated code with GORM CLI, producing the association helpers as part of the model-driven field helpers.
- Basic familiarity with GORM ORM and how associations work conceptually.
- Understanding of context (`ctx context.Context`) usage in database operations.

---

## Expected Outcome

By following this guide, you will be able to:
- Create and link associated records in various relation types.
- Update related records conditionally.
- Unlink associations without deleting data.
- Delete related records safely.
- Perform batch creation/linking operations.
- Understand the semantics of each association operation for different association types.

---

## Time Estimate

Approximately 15-25 minutes to work through examples and understand patterns.

---

## Difficulty Level

Intermediate — requires knowledge of Go, GORM, and basic SQL relational concepts.

---

## Association Helper Types

GORM CLI generates two main kinds of association helpers for your models:

- `field.Struct[T]`: For associations that represent a single related entity (e.g., `has-one`, `belongs-to`).
- `field.Slice[T]`: For associations with multiple related entities (e.g., `has-many`, `many-to-many`).

These helpers expose methods to perform association operations like `Create`, `Update`, `Delete`, `Unlink`, and `CreateInBatch`.

---

## Step-by-Step Instructions

<Steps>
<Step title="Create and Associate a Single Related Record (Has-One / Belongs-To)">
Use the `.Create()` helper on a `field.Struct` association to create a related record and link it by foreign keys. This operation should be called with `Set(...)` and terminated by `.Create(ctx)` (for new parents) or `.Update(ctx)` (for existing parents).

```go
// Create a new User and single Account
gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Account.Create(generated.Account.Number.Set("A-001")),
  ).
  Create(ctx)
```

### Expected Result
- User is inserted.
- Account is inserted with foreign key referencing the User.

### Verification
Query for the Account by number and check that UserID is set correctly.

</Step>

<Step title="Batch Create and Link Multiple Related Records (Has-Many / Many-To-Many)">
Leverage `.CreateInBatch()` on `field.Slice` associations to create multiple related records for each matched parent.

```go
// Batch create and link Pets for matched Users
pets := []Pet{{Name: "fido"}, {Name: "rex"}}
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.CreateInBatch(pets),
  ).
  Update(ctx)
```

### Expected Result
- Pets are created and linked to the User with ID=1.

### Verification
Query pets where `user_id = 1` and verify two pets exist.

</Step>

<Step title="Update Associated Records Conditionally">
Use `.Where(...).Update(...)` chaining on an association helper to apply conditional updates to associated records.

```go
// Update a User’s pet name where pet name is 'old'
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Update(
      generated.Pet.Name.Set("new"),
    ),
  ).
  Update(ctx)
```

### Expected Result
- Only pets with the name 'old' are updated to 'new'.

### Verification
Query pets whose names are 'new' and check their association.

</Step>

<Step title="Unlink Associations (Leave Related Records Intact)">
Use `.Unlink()` on association helpers to break the association links without deleting the related rows. This corresponds to setting foreign keys to NULL or deleting join table rows depending on association type.

```go
// Unlink Pets from User (sets pets.user_id to NULL)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Unlink(),
  ).
  Update(ctx)
```

### Semantics by Association Type
- `belongs to`: clears parent's foreign key.
- `has one/has many`: clears child's foreign key.
- `many2many`: removes join table rows only.

### Verification
Query pets where user_id IS NULL and ensure pets exist.

</Step>

<Step title="Delete Associated Records">
Use `.Delete()` to remove associated rows themselves (not only unlinking).

```go
// Delete Pets named 'a' for User with ID 1
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("a")).Delete(),
  ).
  Update(ctx)
```

### Important
- Many-to-many delete only removes join rows, not the related entities.
- Be cautious with deletions as they are destructive.

### Verification
Find pets with that name after deletion—they should not exist.

</Step>

<Step title="Create and Link Many-to-Many Associations">
Use `.Create()` or `.CreateInBatch()` on many-to-many associations to link or create related rows with proper join table management.

```go
// Create and add languages spoken by User
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Languages.Create(
      generated.Language.Code.Set("EN"),
      generated.Language.Name.Set("English"),
    ),
  ).
  Update(ctx)

// Batch create/link many languages
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Languages.CreateInBatch([]models.Language{{Code: "FR"}, {Code: "DE"}}),
  ).
  Update(ctx)
```

### Verification
Count associated languages via GORM association counting methods.

</Step>

<Step title="Association Semantics Summary">

| Association Type | Create Behavior                | Unlink Behavior                              | Delete Behavior                             |
|------------------|-------------------------------|----------------------------------------------|---------------------------------------------|
| belongs to       | Set parent FK on child         | Set parent's FK NULL                         | Delete associated records                   |
| has one/has many | Set child FK                    | Set child's FK NULL                          | Delete associated child records             |
| many-to-many     | Insert join table rows          | Delete join table rows only (keep related) | Delete join table rows only (keep related) |

</Step>
</Steps>

---

## Examples & Real Scenarios

```go
// Create a user with a pet
_, err := gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Pets.Create(generated.Pet.Name.Set("fido")),
  ).
  Create(ctx)
if err != nil {
  panic(err)
}

// Update the pet name conditionally
_, err = gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Update(generated.Pet.Name.Set("rex")),
  ).
  Update(ctx)

// Unlink pets without deleting
_, err = gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)

// Delete a pet
_, err = gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("rex")).Delete()).
  Update(ctx)
```

These examples mirror workflows encountered in complex domains, such as users managing accounts, pets, languages, or friends with clean, fluent APIs.

---

## Best Practices

- Always use context (`ctx`) to manage cancellation and timeouts.
- Use `.Where(...)` to scope updates, deletes, and unlinks precisely.
- Prefer `.Unlink()` if you want to break relationships without data loss.
- For creating associations in bulk, use `.CreateInBatch()` to optimize queries.
- Test association operations in isolated transactions to verify association behavior.

---

## Troubleshooting & Common Issues

<AccordionGroup title="Troubleshooting Associations">
<Accordion title="Why isn’t the associated record linked after Create?">
Verify you are calling `.Create(ctx)` or `.Update(ctx)` on the parent operation after using `.Set()`. The association ops only prepare the clause.

Check your foreign key tags and database schema for consistency.
</Accordion>
<Accordion title="I get SQL errors with complex conditions">
Ensure the generated `Where` conditions on associations use properly constructed predicates from the generated helpers.

Avoid manual SQL strings that bypass the type-safe builders.
</Accordion>
<Accordion title="Unlink doesn’t seem to set FK NULL as expected">
Confirm your model’s foreign key fields allow NULLs, and GORM associations are properly configured for the relationship.

Check database constraints that might prevent setting NULL.
</Accordion>
<Accordion title="Batch creation duplicates data unexpectedly">
Ensure the slice passed to `.CreateInBatch()` only contains records you intend to match or create.

Test with a small data set first to confirm behavior before bulk operations.
</Accordion>
</AccordionGroup>

---

## Next Steps & Related Content

- [Using the Generated APIs](/guides/core-workflows/using-generated-apis) — Learn how to combine these associations with query API usage.
- [Model-Driven Field Helpers](/guides/core-workflows/field-helpers-basics) — Deep dive on fields, predicates, and setter helpers.
- [Template-Based Query Generation](/guides/advanced-patterns/template-based-sql) — Advanced SQL templating for queries beyond basic associations.
- [Configuration & Extensibility](/overview/features-and-workflows/configuring-generation) — Customize generation for your association helpers.

Refer to the example tests in [examples/output/models_relations_test.go](https://github.com/go-gorm/cli/blob/main/examples/output/models_relations_test.go) for working, real-world association usage scenarios.

---

## Summary Mermaid Diagram

```mermaid
flowchart TD
  User["User Model"] -->|has one| Account["Account Model"]
  User -->|has many| Pets["Pets Model"]
  User -->|belongs to| Company["Company Model"]
  User -->|many2many| Languages["Languages Model"]
  User -->|many2many| Friends["User Friend Models"]

  subgraph Association Operations
    CreateOp["Create"]
    UpdateOp["Update"]
    UnlinkOp["Unlink"]
    DeleteOp["Delete"]
    BatchCreateOp["CreateInBatch"]
  end

  Account -.->|Struct[T]| AssociationOp[Association Helpers]
  Pets -.->|Slice[T]| AssociationOp
  Languages -.->|Slice[T]| AssociationOp

  User -- use --> AssociationOp
  AssociationOp --> CreateOp
  AssociationOp --> UpdateOp
  AssociationOp --> UnlinkOp
  AssociationOp --> DeleteOp
  AssociationOp --> BatchCreateOp

  %% Styling
  classDef association fill:#f3f4f6,stroke:#0366d6,stroke-width:1.5px;
  class User,Account,Pets,Company,Languages,Friends association;
  class AssociationOp,CreateOp,UpdateOp,UnlinkOp,DeleteOp,BatchCreateOp fill:#dcfce7,stroke:#166534,stroke-width:1.5px;
```

---

<Tip>
Leverage association helpers to write clean, expressive, and type-safe relationship operations that scale with your Go application’s complexity.
</Tip>

<Check>
Remember that association operations are designed to be used within the `.Set()` call chain followed by `.Create(ctx)` or `.Update(ctx)` on the parent entity.
</Check>
