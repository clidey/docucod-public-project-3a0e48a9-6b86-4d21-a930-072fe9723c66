---
title: "Working with Associations"
description: "In-depth guide to association helpers—covering creation, linking, unlinking, and deleting of related data. This page explains relationship semantics, best practices for parent/child operations, and illustrates usage with real multi-table examples."
---

# Working with Associations

Explore how GORM CLI’s generated association helpers let you intuitively create, link, update, unlink, and delete related data, ensuring safe and clear operations on complex relationships. This guide walks you through practical workflows, illustrating real-world multi-table examples and covering the semantics of different association types.

---

## 1. Understanding Association Helpers

GORM CLI generates association helpers as `field.Struct[T]` for single references (has one, belongs to) and `field.Slice[T]` for collections (has many, many2many). These helpers provide rich methods to manage relational data safely at compile time.

### Key Association Operations

- **Create**: Insert and associate new related records per matched parent.
- **Update**: Modify associated records matching optional conditions.
- **Unlink**: Remove relational links without deleting records (nullify foreign keys or remove join rows).
- **Delete**: Remove associated records entirely (special semantics for many2many).
- **CreateInBatch**: Batch create/link multiple associated records.

### Using the Helpers
Association operations compose inside `.Set(...)` used with `.Create(ctx)` or `.Update(ctx)` on the parent entity.

---

## 2. Association Semantics by Relationship Type

| Association Type | Create               | Update                 | Unlink Semantics                                | Delete Semantics                              |
|------------------|----------------------|------------------------|------------------------------------------------|-----------------------------------------------|
| Belongs To       | Create associated entity | Update if conditions match | Sets parent's foreign key to NULL               | Deletes associated entity                      |
| Has One / Many   | Create new child entity  | Update child rows matching conditions | Sets child's foreign key to NULL               | Deletes child rows                             |
| Many2Many        | Create new join rows/link entities | Update linked entities | Removes join table rows but keeps entities      | Deletes join table rows; associated entities remain |

---

## 3. Practical Workflows for Association Operations

### Create and Link Associations

You can create and associate related records in one step when creating or updating a parent record.

```go
// Create a new User and one Pet (has many)
gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Pets.Create(generated.Pet.Name.Set("fido")),
  ).
  Create(ctx)

// Create a new User and link multiple Languages (many2many)
gorm.G[User](db).
  Set(
    generated.User.Name.Set("polyglot"),
    generated.User.Languages.CreateInBatch([]models.Language{{Code: "EN"}, {Code: "FR"}}),
  ).
  Create(ctx)
```

#### Expected Outcome
- Parent row(s) inserted
- Associated rows inserted and linked appropriately

---

### Update Associated Records with Conditions

Updates affect only related rows matching the specified filter conditions.

```go
// Update user's pet named "fido" to "rex"
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Update(
      generated.Pet.Name.Set("rex"),
    ),
  ).
  Update(ctx)
```

#### Expected Outcome
- Only pets named "fido" related to user with ID=1 are changed

---

### Unlink Associations

Unlinking removes relational links without deleting associated records.

```go
// Unlink all pets from user (sets pets.user_id to NULL)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)

// Unlink specific language from user (remove join rows)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.Where(generated.Language.Code.Eq("EN")).Unlink()).
  Update(ctx)
```

#### Expected Outcome
- Foreign keys nullified or join rows removed
- Associated rows remain intact

---

### Delete Associated Records

Deleting removes associated records from the database.

```go
// Delete pets named "a" for user 1
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("a")).Delete()).
  Update(ctx)

// Delete language "EN2" association (join row removed, language remains)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.Where(generated.Language.Code.Eq("EN2")).Delete()).
  Update(ctx)
```

#### Expected Outcome
- Associated rows matching conditions removed
- For many2many, only join rows deleted; entities remain

---

### Batch Create or Link Associations

For efficiency, create/link multiple associated records at once.

```go
// Batch create pets for a user (has many)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.CreateInBatch(
    []models.Pet{{Name: "bm1"}, {Name: "bm2"}},
  )).
  Update(ctx)

// Batch link languages to a user (many2many)
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch(
    []models.Language{{Code: "B1"}, {Code: "B2"}},
  )).
  Update(ctx)
```

#### Expected Outcome
- All provided records inserted and linked in a single batch operation

---

## 4. Code Examples from Real Tests

Here are some extracted scenarios showcasing how association helpers are used in practice.

<AccordionGroup title="Association Operation Examples">
<Accordion title="Create a Pet for a Single User">
```go
_, err := gorm.G[models.User](db).
    Where(generated.User.ID.Eq(u.ID)).
    Set(
        generated.User.Pets.Create(
            generated.Pet.Name.Set("test-pet"),
        ),
    ).
    Update(ctx)
if err != nil {
    t.Fatalf("assoc create single failed: %v", err)
}
```
</Accordion>
<Accordion title="Update Associated Pet Using Condition">
```go
_, err := gorm.G[models.User](db).
    Where(generated.User.ID.Eq(u.ID)).
    Set(
        generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Update(
            generated.Pet.Name.Set("new"),
        ),
    ).
    Update(ctx)
if err != nil {
    t.Fatalf("assoc update failed: %v", err)
}
```
</Accordion>
<Accordion title="Unlink Has Many Association (Pets)">
```go
_, err := gorm.G[models.User](db).
    Where(generated.User.ID.Eq(u.ID)).
    Set(
        generated.User.Pets.Unlink(),
    ).
    Update(ctx)
if err != nil {
    t.Fatalf("assoc unlink failed: %v", err)
}
```
</Accordion>
<Accordion title="Delete Has One Association (Account)">
```go
_, err := gorm.G[models.User](db).
    Where(generated.User.ID.Eq(u.ID)).
    Set(
        generated.User.Account.Delete(),
    ).
    Update(ctx)
if err != nil {
    t.Fatalf("has one delete failed: %v", err)
}
```
</Accordion>
<Accordion title="Many-to-Many Create and Unlink (Languages)">
```go
// Create and link language
_, err := gorm.G[models.User](db).
    Where(generated.User.ID.Eq(u.ID)).
    Set(generated.User.Languages.Create(generated.Language.Code.Set("EN"), generated.Language.Name.Set("English"))).
    Update(ctx)

// Unlink language
_, err = gorm.G[models.User](db).
    Where(generated.User.ID.Eq(u.ID)).
    Set(generated.User.Languages.Where(generated.Language.Code.Eq("EN")).Unlink()).
    Update(ctx)
```
</Accordion>
</AccordionGroup>

---

## 5. Best Practices & Tips

- **Match Associations Carefully:** Specify appropriate filtering with `.Where()` on associations to avoid unintended bulk operations.
- **Choose Between Unlink and Delete:** Use Unlink to keep data but remove association; use Delete when associated data should be removed.
- **Leverage Batch Creates:** For multiple related records, use `CreateInBatch` to improve performance and maintain atomicity.
- **Combine with Parent Filters:** Apply `.Where()` on parent entities to target specific records before association operations.
- **Test Association Effects:** Validate changes by querying both parent and associated entities.

---

## 6. Troubleshooting Common Issues

<AccordionGroup title="Association Troubleshooting">
<Accordion title="No Changes After Update">
Check that `.Where()` filters on both parent and association are correct, and that the targeted associated records exist matching conditions.
</Accordion>
<Accordion title="Unlink Does Not Remove Records">
This is expected; Unlink only removes association links (foreign key NULL or join rows). To remove rows, use Delete.
</Accordion>
<Accordion title="Batch Create Too Many Records">
Ensure batch record slices contain only the intended associated items.
</Accordion>
<Accordion title="Foreign Key Constraints Violation">
When unlinking or deleting, ensure the database allows NULL foreign keys or cascading deletes as per your schema.
</Accordion>
<Accordion title="Unexpected Rows Deleted in Many2Many">
Verify that `.Delete()` is used carefully on many2many to avoid deleting associated entities; it only removes join rows.
</Accordion>
</AccordionGroup>

---

## 7. Next Steps & Related Documentation

- Explore [Model-Driven Field Helpers and Updates](/guides/core-workflows/model-driven-field-helpers) for in-depth update and filter guidance.
- See [Using Type-Safe Query APIs](/guides/core-workflows/using-type-safe-query-apis) to combine generated query interfaces and association operations smoothly.
- Refer to [Project Configuration](/getting-started/first-steps/project-configuration) for customizing generation of association helpers.
- Use [Generating Code](/getting-started/first-steps/generating-code) guide to learn how to trigger generating these association helpers.

---

## 8. Visualizing Association Operations

```mermaid
flowchart TD
  subgraph Parent_Entity
    U["User"]
  end

  subgraph Associations
    Acc["Account (has one)"]
    Pet["Pet (has many)"]
    Lang["Language (many2many)"]
    Comp["Company (belongs to)"]
  end

  %% Create
  U -->|Create+Link| Acc
  U -->|Create+Link| Pet
  U -->|CreateInBatch| Lang

  %% Update
  U -->|Update Child| Acc
  U -->|Update Child (filtered)| Pet
  U -->|Update Associated| Lang
  U -->|Update Parent ForeignKey| Comp

  %% Unlink
  U -->|Unlink (FK NULL or join row removed)| Acc
  U -->|Unlink (FK NULL)| Pet
  U -->|Unlink (join row removed)| Lang
  U -->|Unlink (FK NULL)| Comp

  %% Delete
  U -->|Delete Child Rows| Acc
  U -->|Delete Child Rows (filtered)| Pet
  U -->|Delete Join Rows Only| Lang

  %% Labels
  classDef parent fill:#cde9f9,stroke:#337ab7,stroke-width:2px;
  class U parent;
  classDef assoc fill:#e9f3cd,stroke:#7a9d37,stroke-width:2px;
  class Acc,Pet,Lang,Comp assoc;
```

This diagram illustrates how operations flow from the parent entity to associated data depending on the relationship type.

---

# Summary

This guide fed a coherent, practical approach to using GORM CLI’s generated association helpers for managing related data in Go projects. By understanding the semantics of each association type and leveraging operations like Create, Update, Unlink, Delete, and batch actions, you gain precise control over complex relational workflows with type safety and clarity.
