---
title: "Working with Associations & Relationships"
description: "Detailed guide on using association helpers for common ORM patterns—has one, has many, belongs to, many-to-many—covering create, update, unlink, delete, and batch operations. Includes parent and child update semantics and usage tips."
---

# Working with Associations & Relationships

This guide provides a detailed, actionable workflow for using the association helpers generated by GORM CLI to handle common ORM relationship patterns. You'll learn how to create, update, unlink, delete, and batch operate on associated records using type-safe, fluent methods that integrate seamlessly with GORM.

---

## 1. Understanding Association Helpers

### What You Can Achieve Here

- Manage `has one`, `has many`, `belongs to`, and `many-to-many` relationships.
- Perform association operations: **Create**, **CreateInBatch**, **Update**, **Unlink**, and **Delete**.
- Apply conditions to narrow down associated records.
- Understand semantic differences in unlinking and deleting across association types.

### Prerequisites

- Basic familiarity with GORM models and relationships.
- Generated model helpers with association fields (e.g., `generated.User.Pets`).
- Go environment with GORM CLI-generated code included in your project.

### Expected Outcome

You'll confidently manipulate related data in your database using concise, type-safe API calls that automatically handle foreign keys and join tables.

### Time Estimate

15-30 minutes to get familiar and start working with associations in typical Go applications.

### Difficulty Level

Intermediate — requires understanding of basic Go, GORM models, and database associations.

---

## 2. Core Concepts of Association Helpers

### Association Field Types

- **Struct[T]**: Represents a single association (`has one`, `belongs to`).
- **Slice[T]**: Represents multiple associations (`has many`, `many-to-many`).

Each association helper allows you to chain operations and conditions in a fluent manner.

### Available Operations

| Operation       | Description                                                                                                              | Use With                  |
|-----------------|--------------------------------------------------------------------------------------------------------------------------|---------------------------|
| `Create`        | Create and associate a new record per matched parent.                                                                    | `Set(...).Create(ctx)`    |
| `CreateInBatch` | Batch create multiple records and link them per matched parent.                                                          | `Set(...).Create(ctx)`    |
| `Update`        | Update matched associated records with optional filtering conditions.                                                   | `Set(...).Update(ctx)`    |
| `Unlink`        | Remove association (clear foreign keys or join-table rows) without deleting records.                                     | `Set(...).Update(ctx)`    |
| `Delete`        | Delete associated records or join-table rows based on association type and filter criteria.                              | `Set(...).Update(ctx)`    |

### Semantic Differences

- **Belongs To**: `Unlink` clears the parent's foreign key; `Delete` removes the associated records.
- **Has One / Has Many**: `Unlink` clears the child's foreign key; `Delete` removes child records.
- **Many-to-Many**: `Unlink` and `Delete` remove join table rows only; the related records remain intact.

---

## 3. Step-by-Step: Using Association Helpers

<Steps>
<Step title="Create and Associate a Record">
To create a single related record and link it to a matched parent:

```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(userID)).
  Set(
    generated.User.Pets.Create(
      generated.Pet.Name.Set("Fluffy"),
    ),
  ).
  Update(ctx)
if err != nil {
  // Handle error
}
```

**Outcome:** A new `Pet` record named "Fluffy" is created and associated with the `User` with `userID`.

**Notes:** This works for `has many` or other slice associations.
</Step>
<Step title="Update Associated Records Conditionally">
To update associated records with conditions:

```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(userID)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("Fluffy")).
      Update(generated.Pet.Name.Set("Fido")),
  ).
  Update(ctx)
if err != nil {
  // Handle error
}
```

**Outcome:** Only pets named "Fluffy" linked to the user are renamed "Fido".

**Tip:** Use `Where()` to specify conditions precisely on the association's side.
</Step>
<Step title="Unlink Associated Records">
To remove associations without deleting the related records:

```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(userID)).
  Set(
    generated.User.Pets.Unlink(),
  ).
  Update(ctx)
if err != nil {
  // Handle error
}
```

**Outcome:** The user's pets have their foreign keys set to NULL (or join rows removed), but the pet records remain.

**Warning:** Unlink behavior varies by association. Confirm FK semantics for your case.
</Step>
<Step title="Delete Associated Records">
To delete associated records:

```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(userID)).
  Set(
    generated.User.Pets.Delete(),
  ).
  Update(ctx)
if err != nil {
  // Handle error
}
```

**Outcome:** All pets associated with the user are removed from the database.

**Note:** With many-to-many, only join table rows are deleted; related rows remain.
</Step>
<Step title="Batch Create Multiple Associations">
To create multiple associated records for each matched parent:

```go
pets := []Pet{
  {Name: "Buddy"},
  {Name: "Charlie"},
}

_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(userID)).
  Set(
    generated.User.Pets.CreateInBatch(pets),
  ).
  Update(ctx)
if err != nil {
  // Handle error
}
```

**Outcome:** Two pets, "Buddy" and "Charlie", are linked to the given user.

**Tip:** Batch creation reduces individual insert operations.
</Step>
</Steps>

---

## 4. Practical Examples

### Creating a User with Associated Records

```go
// Create a new User with a linked Account and two Pets
err := gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Age.Set(30),
    generated.User.Account.Create(generated.Account.Number.Set("A-123")),
    generated.User.Pets.CreateInBatch([]Pet{{Name: "Fido"}, {Name: "Whiskers"}}),
  ).
  Create(ctx)
if err != nil {
  // Handle error
}
```

### Updating an Associated Account's Number

```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(userID)).
  Set(
    generated.User.Account.Where(generated.Account.Number.Eq("A-123")).
      Update(generated.Account.Number.Set("A-456")),
  ).
  Update(ctx)
```

### Unlinking a Many-to-Many association (Languages)

```go
_, err := gorm.G[User](db).
  Where(generated.User.ID.Eq(userID)).
  Set(
    generated.User.Languages.Where(generated.Language.Code.Eq("EN")).Unlink(),
  ).
  Update(ctx)
```

---

## 5. Troubleshooting & Tips

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Unable to Create Associated Records">
- **Cause:** Missing `Set()` call with `Create` inside.
- **Fix:** Ensure your code includes `Set(...).Create(ctx)` or uses `Set(...).Update(ctx` appropriately.
</Accordion>
<Accordion title="Unlink Not Removing Association">
- **Cause:** Using `Unlink()` incorrectly or not paired with `Update(ctx)`.
- **Fix:** Verify you are chaining `Set(assoc.Unlink()).Update(ctx)` and your association type matches expected unlink behavior.
</Accordion>
<Accordion title="Association Conditions Not Applying">
- **Cause:** Misplaced `Where(...)` invocation on the association helper.
- **Fix:** Always chain `.Where(...)` directly on the association helper before calling `Update(...)` or `Unlink()`.
</Accordion>
</AccordionGroup>

<Tip>
When working with polymorphic associations (e.g., `Pet.Toy`), the foreign key fields include both an ID and a type. Unlinking will clear these appropriately, but always verify your foreign key structure in the model.
</Tip>

<Tip>
Batch creates (`CreateInBatch`) are efficient for inserting multiple records but require the entire slice in memory. Use cautiously with very large datasets.
</Tip>

---

## 6. Next Steps & Related Guides

- Explore the [Model-Driven Field Helper Generation](https://docs.gorm.io/guides/core-workflows/model-driven-field-helpers) guide to understand base fields and predicate usage.
- Refer to [Generating & Using Type-Safe Query APIs](https://docs.gorm.io/guides/core-workflows/generating-and-using-query-apis) to learn integrating these associations in complex queries.
- Review [Troubleshooting Common Setup Issues](https://docs.gorm.io/getting-started/troubleshooting-and-validation/common-issues) if you encounter errors using association helpers.

---

For full working examples, see the `examples/output/models_relations_test.go` file in the GORM CLI repository, which provides extensive real-world test cases demonstrating each association operation.

---