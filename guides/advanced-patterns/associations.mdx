---
title: "Managing Associations with Field Helpers"
description: "Master the use of association helpers for 'has one', 'has many', 'belongs to', and 'many2many' relationships. Explore how to create, update, unlink, and delete associated records with confidence and clarity, using composition patterns and conditional logic."
---

# Managing Associations with Field Helpers

Master the use of association helpers for 'has one', 'has many', 'belongs to', and 'many2many' relationships. Explore how to create, update, unlink, and delete associated records with confidence and clarity, using composition patterns and conditional logic.

---

## 1. Overview

### What This Guide Helps You Accomplish
This guide empowers you to efficiently manage associations in your GORM models using the generated field helpers from GORM CLI. You'll master operations such as creating, updating, unlinking, and deleting related records across different association types ('has one', 'has many', 'belongs to', 'many2many'), leveraging typed helpers that guarantee compile-time safety and expressive query building.

### Prerequisites
- You have run the GORM CLI generator on your project to produce the model-driven field helpers (see [Generating Type-Safe Query APIs](https://gorm.io/cli/gorm/examples/output/models/user.go) and related guides).
- Familiarity with basic GORM associations in your Go models, including understanding how `has one`, `has many`, `belongs to`, and `many2many` relationships are modeled.
- GORM CLI and your project environment set up with necessary imports (Go 1.18+).

### Expected Outcome
By following this guide, you will be able to:
- Use association field helpers such as `field.Struct[T]` and `field.Slice[T]` to compose relation operations.
- Perform powerful, conditional association operations inline with your parent record mutation (create/update).
- Understand unlinking versus deleting in different association contexts and apply the correct semantics.
- Use batch creation for `has many` and `many2many` relations effectively.
- Confidently handle polymorphic associations.

### Time Estimate
15-25 minutes to read through the guide and try the examples.

### Difficulty Level
Intermediate — assumes understanding of GORM associations and basic Go generics.

---

## 2. Understanding Association Field Helpers

GORM CLI generates typed field helpers that represent associations in your models, exposed as:

- `field.Struct[T]` for single-object relations (`has one`, `belongs to`).
- `field.Slice[T]` for collections (`has many`, `many2many`).

These helpers provide methods to create, update, unlink or delete associated records in a strongly typed and fluent manner, reducing runtime errors and improving code readability.

### Association Types & Helper Correspondence
| Association Type | Example from `User` model            | Helper Type       |
|------------------|------------------------------------|-------------------|
| Has One          | `Account`                          | `field.Struct[Account]` |
| Has Many         | `Pets`                            | `field.Slice[Pet]`       |
| Belongs To       | `Company`                        | `field.Struct[Company]`   |
| Many2Many        | `Languages`, `Friends`            | `field.Slice[Language]`, `field.Slice[User]` |

Polymorphic relations (like `Toy` owned by `Pet`) are also handled as `field.Struct[Toy]` or `field.Slice[Toy]` as applicable.

---

## 3. Performing Association Operations

All association operations are chained with the `.Set(...)` method on the parent model's query builder and finalize with `.Create(ctx)` or `.Update(ctx)`.

### 3.1 Creating Associated Records

- **Single Association (`has one`/`belongs to`):**

```go
gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Account.Create(generated.Account.Number.Set("A-001")),
  ).
  Create(ctx)
```

- **Multiple Associations (`has many`/`many2many`):**

```go
gorm.G[User](db).
  Set(
    generated.User.Name.Set("petlover"),
    generated.User.Pets.Create(generated.Pet.Name.Set("fido")),
  ).
  Create(ctx)

// Batch create multiple associated pets for each matched user
gorm.G[User](db).
  Set(
    generated.User.Pets.CreateInBatch([]models.Pet{{Name: "bobby"}, {Name: "rex"}}),
  ).
  Update(ctx)
```

<Tip>
Use `CreateInBatch` for batch association creation or linking in `has many` and `many2many` relationships, which improves performance when associating multiple records.
</Tip>

### 3.2 Updating Associated Records

You can perform conditional updates on associated records:

```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Update(
      generated.Pet.Name.Set("rex"),
    ),
  ).
  Update(ctx)
```

This updates the pet named 'fido' for the user where user ID = 1, renaming it to 'rex'.

### 3.3 Unlinking Associations

Unlinking removes the association link but keeps the associated record intact.

- For **belongs to**, parent FK is cleared (set to NULL).
- For **has one/has many**, child FK is cleared.
- For **many2many**, join table rows are deleted.

Example:

```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)
```

This unlinks all pets from the user with ID=1 by setting their foreign keys `user_id` to `NULL`.

### 3.4 Deleting Associated Records

Deletes remove the associated records entirely.

```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Delete()).
  Update(ctx)
```

Deletes all pets named 'old' belonging to the specified user.

<Warning>
Unlink vs Delete: be careful! Deleting permanently removes associated records, while unlinking only removes the association link. Use delete with caution.
</Warning>

---

## 4. Real Usage Examples

Below are practical code snippets demonstrating common association operations.

### 4.1 Creating Associated Records
```go
// Create a new user and one pet
gorm.G[User](db).
  Set(
    generated.User.Name.Set("alice"),
    generated.User.Pets.Create(generated.Pet.Name.Set("fido")),
  ).
  Create(ctx)

// Create a new user and link two languages (many2many)
gorm.G[User](db).
  Set(
    generated.User.Name.Set("polyglot"),
    generated.User.Languages.CreateInBatch([]models.Language{{Code: "EN"}, {Code: "FR"}}),
  ).
  Create(ctx)
```

### 4.2 Updating Associations Conditionally

```go
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(
    generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Update(
      generated.Pet.Name.Set("rex"),
    ),
  ).
  Update(ctx)
```

### 4.3 Unlinking Associations

```go
// Unlink all pets from a user
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Unlink()).
  Update(ctx)

// Unlink conditionally
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("fido")).Unlink()).
  Update(ctx)
```

### 4.4 Deleting Associated Rows

```go
// Delete pets named 'old' for the user
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.Where(generated.Pet.Name.Eq("old")).Delete()).
  Update(ctx)
```

### 4.5 Batch Linking in Associations

```go
// Batch link existing pets to the user
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Pets.CreateInBatch(
    []models.Pet{{Name: "bm1"}, {Name: "bm2"}},
  )).
  Update(ctx)

// Batch link many2many languages
gorm.G[User](db).
  Where(generated.User.ID.Eq(1)).
  Set(generated.User.Languages.CreateInBatch([]models.Language{{Code: "B1"}, {Code: "B2"}})).
  Update(ctx)
```

### 4.6 Polymorphic Association Example

Working with polymorphic `Toy` for a `Pet`:

```go
// Update toy name
gorm.G[Pet](db).
  Where(generated.Pet.ID.Eq(petID)).
  Set(generated.Pet.Toy.Where(generated.Toy.Name.Eq("ball")).Update(generated.Toy.Name.Set("cube"))).
  Update(ctx)

// Unlink toy (sets OwnerID, OwnerType to zero/empty)
gorm.G[Pet](db).
  Where(generated.Pet.ID.Eq(petID)).
  Set(generated.Pet.Toy.Unlink()).
  Update(ctx)

// Delete toy row
gorm.G[Pet](db).
  Where(generated.Pet.ID.Eq(petID)).
  Set(generated.Pet.Toy.Delete()).
  Update(ctx)
```

---

## 5. Best Practices and Tips

- **Always specify conditions when updating or deleting associations** to avoid unexpected mass updates or deletes.
- Use **unlink** when you want to remove associations but keep data intact to maintain history or prevent unwanted data loss.
- Use **batch create (`CreateInBatch`)** for efficient bulk association operations instead of multiple individual create calls.
- When working with **`many2many`**, remember that unlink and delete operate on join table entries — deleting join rows but not the related entity records.
- Utilize generated field helpers for **fluent, type-safe code** rather than raw strings, to prevent SQL injection vulnerabilities and reduce bugs.
- For polymorphic associations, always respect their ownership columns and use the association helpers appropriately.

<Check>
- Validate your operation by querying related records afterward.
- Handle errors returned from `.Create(ctx)` or `.Update(ctx)` to detect failures.
</Check>

---

## 6. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting Association Operations">
<Accordion title="Why does my deletion not remove the main associated record?">
Many2many `.Delete()` only removes join table rows, not the associated table row itself, preserving data integrity. To remove the record itself, delete it explicitly with a separate operation.
</Accordion>
<Accordion title="Update does not affect any associated rows.">
Ensure your `.Where(...)` condition targets existing related records. Confirm associations and foreign keys are correctly defined in your models.
</Accordion>
<Accordion title="Unlink seems to delete associated records.">
Unlink only clears foreign key links or removes join table entries. If records are deleted, verify you are not confusing Unlink with Delete operations.
</Accordion>
<Accordion title="Batch create fails due to unsupported types or fields.">
Check that the slice passed to `CreateInBatch` contains structs matching your model and that your model fields comply with GORM's requirements (e.g., foreign keys, constraints).
</Accordion>
<Accordion title="Polymorphic association operations fail or behave unexpectedly.">
Verify that polymorphic keys (`OwnerID`, `OwnerType`) are properly set in your data. Use the polymorphic association helpers generated for these relationships.
</Accordion>
</AccordionGroup>

---

## 7. Related Resources & Next Steps

- Explore the [Model-Driven Field Helpers](https://gorm.io/cli/gorm/examples/output/models/user.go) to understand how helper structs are generated for your models.
- Visit the [Working with Generated APIs](https://gorm.io/cli/gorm/guides/core-workflows/using-generated-apis) guide to build complex queries leveraging type-safe APIs.
- Deepen your understanding of [Template-Based Query Generation](https://gorm.io/cli/gorm/guides/advanced-patterns/template-queries) for customizing SQL queries alongside associations.
- Review the [Advanced Code Generation Configuration](https://gorm.io/cli/gorm/guides/core-workflows/configuring-generation) guide to customize association mappings.

---

For detailed code examples and test coverage, see the comprehensive association tests: [models_relations_test.go](https://github.com/go-gorm/cli/blob/main/examples/output/models_relations_test.go).

---